<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‚ö° Flashloan Arbitrage Pro - Deploy & Execute</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@4.3.0/dist/web3.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
            color: #fff;
            padding: 10px;
            min-height: 100vh;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            text-align: center;
        }

        .header h1 {
            font-size: 1.5em;
            background: linear-gradient(45deg, #00d4ff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .status-pills {
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .pill {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75em;
            font-weight: 600;
        }

        .pill.connected { background: #10b981; }
        .pill.disconnected { background: #ef4444; }
        .pill.scanning { 
            background: #f59e0b; 
            animation: pulse 2s infinite;
        }
        .pill.deploying {
            background: #8b5cf6;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .card {
            background: rgba(255,255,255,0.06);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .card h2 {
            font-size: 1.1em;
            margin-bottom: 12px;
            color: #00d4ff;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn {
            width: 100%;
            padding: 14px;
            border-radius: 8px;
            border: none;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 8px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #00d4ff, #0088ff);
            color: #fff;
        }

        .btn-success {
            background: linear-gradient(45deg, #10b981, #059669);
            color: #fff;
        }

        .btn-danger {
            background: linear-gradient(45deg, #ef4444, #dc2626);
            color: #fff;
        }

        .btn-warning {
            background: linear-gradient(45deg, #f59e0b, #d97706);
            color: #fff;
        }

        .btn-purple {
            background: linear-gradient(45deg, #8b5cf6, #7c3aed);
            color: #fff;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 10px 0;
        }

        .info-item {
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 8px;
        }

        .info-item label {
            font-size: 0.75em;
            opacity: 0.7;
            display: block;
            margin-bottom: 4px;
        }

        .info-item value {
            font-size: 1.1em;
            font-weight: 600;
            color: #00ff88;
            display: block;
        }

        .opp-card {
            background: rgba(0,212,255,0.1);
            border: 1px solid rgba(0,212,255,0.3);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .opp-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .opp-title {
            font-weight: 600;
            font-size: 1em;
        }

        .confidence {
            background: #10b981;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75em;
        }

        .opp-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            font-size: 0.85em;
            margin-bottom: 10px;
        }

        input[type="number"], select {
            width: 100%;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(0,0,0,0.3);
            color: #fff;
            font-size: 0.9em;
            margin-top: 5px;
        }

        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.85em;
            opacity: 0.9;
        }

        .log {
            background: rgba(0,0,0,0.4);
            border-radius: 8px;
            padding: 10px;
            max-height: 200px;
            overflow-y: auto;
            font-size: 0.75em;
            font-family: monospace;
        }

        .log-entry {
            padding: 4px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .log-success { color: #10b981; }
        .log-error { color: #ef4444; }
        .log-warning { color: #f59e0b; }
        .log-info { color: #60a5fa; }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d4ff, #00ff88);
            width: 0%;
            transition: width 0.3s;
        }

        .wallet-info {
            font-size: 0.8em;
            word-break: break-all;
        }

        .deploy-section {
            background: rgba(139,92,246,0.1);
            border: 2px dashed rgba(139,92,246,0.4);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .alert {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
            font-size: 0.85em;
        }

        .alert-info {
            background: rgba(59,130,246,0.2);
            border: 1px solid rgba(59,130,246,0.4);
        }

        .alert-warning {
            background: rgba(245,158,11,0.2);
            border: 1px solid rgba(245,158,11,0.4);
        }

        .alert-success {
            background: rgba(16,185,129,0.2);
            border: 1px solid rgba(16,185,129,0.4);
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
            cursor: pointer;
        }

        .balance-card {
            background: linear-gradient(135deg, rgba(16,185,129,0.2), rgba(5,150,105,0.2));
            border: 1px solid rgba(16,185,129,0.4);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .balance-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        .balance-item {
            background: rgba(0,0,0,0.3);
            padding: 8px;
            border-radius: 6px;
            font-size: 0.85em;
        }

        .profit-badge {
            display: inline-block;
            background: linear-gradient(45deg, #10b981, #059669);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            margin-top: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>‚ö° Flashloan Arbitrage Pro</h1>
            <div class="status-pills">
                <span class="pill disconnected" id="walletStatus">Desconectado</span>
                <span class="pill disconnected" id="contractStatus">Sem Contrato</span>
                <span class="pill disconnected" id="scanStatus">Scan Off</span>
            </div>
        </div>

        <!-- Wallet Connection -->
        <div class="card">
            <h2>üëõ Carteira</h2>
            <button class="btn btn-primary" id="connectBtn" onclick="connectWallet()">
                Conectar OKX Wallet / MetaMask
            </button>
            <div id="walletInfo" style="display:none; margin-top: 10px;">
                <div class="wallet-info">
                    <strong>Endere√ßo:</strong><br>
                    <span id="walletAddress"></span>
                </div>
                <div style="margin-top: 8px;" class="wallet-info">
                    <strong>Saldo:</strong> <span id="walletBalance"></span>
                </div>
            </div>
        </div>

        <!-- Deploy Section -->
        <div class="deploy-section" id="deploySection">
            <h2 style="color: #8b5cf6; margin-bottom: 10px;">üöÄ Deploy do Contrato</h2>
            <div class="alert alert-info">
                ‚ÑπÔ∏è Voc√™ precisa fazer deploy do contrato primeiro. Isso custar√° ~0.005 ETH de gas.
            </div>
            <button class="btn btn-purple" id="deployBtn" onclick="deployContract()" disabled>
                üöÄ Deploy Contrato Agora
            </button>
            <div id="deployProgress" style="display:none; margin-top: 10px;">
                <div style="text-align: center; opacity: 0.8;">
                    Deploying... Aguarde confirma√ß√£o na blockchain
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 50%;"></div>
                </div>
            </div>
        </div>

        <!-- Contract Info -->
        <div class="card" id="contractCard" style="display:none;">
            <h2>üìù Contrato</h2>
            <div class="alert alert-success">
                ‚úÖ Contrato deployado com sucesso!
            </div>
            <div class="wallet-info">
                <strong>Endere√ßo:</strong><br>
                <span id="contractAddress"></span>
            </div>
            <div style="margin-top: 10px;">
                <strong>Owner:</strong> <span id="contractOwner"></span>
            </div>
            
            <!-- Balances -->
            <div class="balance-card" style="margin-top: 12px;">
                <strong>üí∞ Saldos no Contrato:</strong>
                <div class="balance-grid" id="balanceGrid">
                    <div class="balance-item">
                        <div style="opacity: 0.7;">USDC</div>
                        <strong id="balanceUSDC">0.00</strong>
                    </div>
                    <div class="balance-item">
                        <div style="opacity: 0.7;">USDT</div>
                        <strong id="balanceUSDT">0.00</strong>
                    </div>
                    <div class="balance-item">
                        <div style="opacity: 0.7;">DAI</div>
                        <strong id="balanceDAI">0.00</strong>
                    </div>
                    <div class="balance-item">
                        <div style="opacity: 0.7;">WETH</div>
                        <strong id="balanceWETH">0.0000</strong>
                    </div>
                </div>
                <button class="btn btn-success" onclick="withdrawAll()" style="margin-top: 10px;">
                    üí∏ Sacar Todos os Lucros
                </button>
            </div>
        </div>

        <!-- Scanner Config -->
        <div class="card" id="scannerCard" style="display:none;">
            <h2>‚öôÔ∏è Configura√ß√£o</h2>
            
            <label>
                Valor do Flashloan (USDC)
                <input type="number" id="flashloanAmount" value="1000" min="100" max="100000" step="100">
            </label>

            <label>
                Lucro M√≠nimo (%)
                <input type="number" id="minProfitPercent" value="0.5" min="0.1" max="10" step="0.1">
            </label>

            <label>
                Slippage M√°ximo (%)
                <input type="number" id="slippageBps" value="1.0" min="0.1" max="5" step="0.1">
            </label>

            <label class="checkbox-label">
                <input type="checkbox" id="autoExecute">
                <span>ü§ñ Auto-Executar (Popup autom√°tico quando lucrativo)</span>
            </label>

            <div style="margin-top: 10px;">
                <button class="btn btn-success" id="startScanBtn" onclick="startScanner()">
                    üîç Iniciar Scanner
                </button>
                <button class="btn btn-danger" id="stopScanBtn" onclick="stopScanner()" style="display:none;">
                    ‚èπÔ∏è Parar Scanner
                </button>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="scanProgress"></div>
            </div>
        </div>

        <!-- Opportunities -->
        <div class="card" id="oppCard" style="display:none;">
            <h2>üéØ Oportunidades (<span id="oppCount">0</span>)</h2>
            <div id="oppList">
                <div style="text-align: center; opacity: 0.5; padding: 20px;">
                    Nenhuma oportunidade encontrada.<br>
                    Inicie o scanner para procurar.
                </div>
            </div>
        </div>

        <!-- Stats -->
        <div class="card" id="statsCard" style="display:none;">
            <h2>üìä Estat√≠sticas</h2>
            <div class="info-grid">
                <div class="info-item">
                    <label>Execu√ß√µes</label>
                    <value id="statExecutions">0</value>
                </div>
                <div class="info-item">
                    <label>Sucessos</label>
                    <value id="statSuccesses">0</value>
                </div>
                <div class="info-item">
                    <label>Lucro Total</label>
                    <value id="statProfit">$0</value>
                </div>
                <div class="info-item">
                    <label>Melhor</label>
                    <value id="statBest">$0</value>
                </div>
            </div>
        </div>

        <!-- Logs -->
        <div class="card">
            <h2>üìã Logs</h2>
            <button class="btn btn-danger" onclick="clearLogs()" style="width: auto; padding: 8px 16px; margin-bottom: 10px;">
                Limpar
            </button>
            <div class="log" id="logContainer">
                <div class="log-entry log-info">[INICIO] Sistema carregado</div>
            </div>
        </div>
    </div>

    <script>
        // ========== CONFIGURA√á√ÉO ==========
        const CONFIG = {
            CHAIN_ID: '0xa4b1',
            CHAIN_NAME: 'Arbitrum One',
            RPC_URL: 'https://arb1.arbitrum.io/rpc',
            EXPLORER: 'https://arbiscan.io',
            
            AAVE_POOL: '0x794a61358D6845594F94dc1DB02A252b5b4814aD',
            
            DEXS: {
                SUSHISWAP: {
                    router: '0x1b02dA8Cb0d097eB8D57A175b88c7D8b47997506',
                    name: 'SushiSwap'
                },
                CAMELOT: {
                    router: '0xc873fEcbd354f5A56E00E710B90EF4201db2448d',
                    name: 'Camelot'
                }
            },
            
            TOKENS: {
                USDC: { 
                    address: '0xaf88d065e77c8cC2239327C5EDb3A432268e5831',
                    decimals: 6,
                    symbol: 'USDC'
                },
                USDT: {
                    address: '0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9',
                    decimals: 6,
                    symbol: 'USDT'
                },
                WETH: {
                    address: '0x82aF49447D8a07e3bd95BD0d56f35241523fBab1',
                    decimals: 18,
                    symbol: 'WETH'
                },
                WBTC: {
                    address: '0x2f2a2543B76A4166549F7aaB2e75Bef0aefC5B0f',
                    decimals: 8,
                    symbol: 'WBTC'
                },
                DAI: {
                    address: '0xDA10009cBd5D07dd0CeCc66161FC93D7c9000da1',
                    decimals: 18,
                    symbol: 'DAI'
                },
                ARB: {
                    address: '0x912CE59144191C1204E64559FE8253a0e49E6548',
                    decimals: 18,
                    symbol: 'ARB'
                }
            }
        };

        // BYTECODE E ABI DO CONTRATO
        const CONTRACT_BYTECODE = '0x608060405234801561000f575f80fd5b50335f806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550611c358061005d5f395ff3fe608060405234801561000f575f80fd5b506004361061009c575f3560e01c80638da5cb5b116100645780638da5cb5b14610119578063b6f3e08714610137578063c415b95c14610153578063e941fa7814610171578063f3fef3a31461018d5761009c565b80630c340a24146100a057806312065fe0146100be57806351cff8d9146100dc578063715018a6146100f85780638129fc1c14610102575b5f80fd5b6100a86101a9565b6040516100b59190610f3a565b60405180910390f35b6100c66101cd565b6040516100d39190610f63565b60405180910390f35b6100f660048036038101906100f19190610fb0565b6101d4565b005b610100610372565b005b61010a610385565b6040516101109392919061105f565b60405180910390f35b610121610522565b60405161012e9190610f3a565b60405180910390f35b610151600480360381019061014c9190611127565b610545565b005b61015b6108b3565b6040516101689190610f3a565b60405180910390f35b61018b600480360381019061018691906111cb565b6108d7565b005b6101a760048036038101906101a29190611239565b610bcf565b005b7f794a61358d6845594f94dc1db02a252b5b4814ad5f0b360894a13ba1a3210667a81565b5f47905090565b5f8054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610260576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610257906112c1565b60405180910390fd5b5f8173ffffffffffffffffffffffffffffffffffffffff166370a08231306040518263ffffffff1660e01b81526004016102999190610f3a565b602060405180830381865afa1580156102b4573d5f803e3d5ffd5b505050506040513d601f19601f820116820180604052508101906102d891906112f3565b90505f811161031c576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161031390611368565b60405180910390fd5b8173ffffffffffffffffffffffffffffffffffffffff1663a9059cbb335f8054906101000a900473ffffffffffffffffffffffffffffffffffffffff16836040518463ffffffff1660e01b815260040161036e9291906113a0565b5050565b61037a610d45565b6103825f610ddf565b50565b5f805f7f794a61358d6845594f94dc1db02a252b5b4814ad5f0b360894a13ba1a3210667a73ffffffffffffffffffffffffffffffffffffffff16630c340a246040518163ffffffff1660e01b8152600401602060405180830381865afa1580156103f3573d5f803e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061041791906113dc565b90505f8173ffffffffffffffffffffffffffffffffffffffff166312065fe06040518163ffffffff1660e01b8152600401602060405180830381865afa158015610463573d5f803e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061048791906112f3565b90505f8273ffffffffffffffffffffffffffffffffffffffff166370a08231306040518263ffffffff1660e01b81526004016104c29190610f3a565b602060405180830381865afa1580156104dd573d5f803e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061050191906112f3565b90508282829350935093505050565b5f8060149054906101000a900460ff16905090565b5f805f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b5f8054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146105d1576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016105c8906112c1565b60405180910390fd5b5f8211610613576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161060a90611451565b60405180910390fd5b5f73ffffffffffffffffffffffffffffffffffffffff168160200160208101906106379190610fb0565b73ffffffffffffffffffffffffffffffffffffffff160361068d576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610684906114b9565b60405180910390fd5b5f73ffffffffffffffffffffffffffffffffffffffff16816040016020810190610b79190610fb0565b73ffffffffffffffffffffffffffffffffffffffff16036106cf576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016106c690611521565b60405180910390fd5b5f816040516020016106e19190611611565b6040516020818303038152906040529050737f794a61358d6845594f94dc1db02a252b5b4814ad73ffffffffffffffffffffffffffffffffffffffff1663ab9c4b5d30868560015f6040518663ffffffff1660e01b8152600401610749959493929190611745565b5f604051808303815f87803b158015610760575f80fd5b505af1158015610772573d5f803e3d5ffd5b505050507f1e5c1f86ecfee5b7d5ce1f23a4e0b95e8c2e8f5a3d3b5f9e5d7c9b8a6f5e4c3d8383604051610a79929190611787565b60405180910390a1505050565b7f1b02da8cb0d097eb8d57a175b88c7d8b479975065f0b360894a13ba1a3210667a81565b5f8054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461093d576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610934906112c1565b60405180910390fd5b5f47905080831115610984576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161097b90611368565b60405180910390fd5b8373ffffffffffffffffffffffffffffffffffffffff1663a9059cbb335f8054906101000a900473ffffffffffffffffffffffffffffffffffffffff16856040518463ffffffff1660e01b81526004016109e79291906113a0565b6020604051808303815f875af1158015610a03573d5f803e3d5ffd5b505050506040513d601f19601f82011682018060405250810190610a2791906117be565b507f7fcf532c15f0a6db0bd6d0e038bea71d30d808c7d98cb3bf7268a95bf5081b6584604051610a569190610f63565b60405180910390a150505050565b5f80823b90508215610a9c577fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff915050610bcf565b5f8573ffffffffffffffffffffffffffffffffffffffff166318160ddd6040518163ffffffff1660e01b8152600401602060405180830381865afa158015610ae6573d5f803e3d5ffd5b505050506040513d601f19601f82011682018060405250810190610b0a91906112f3565b90505f8673ffffffffffffffffffffffffffffffffffffffff166370a08231886040518263ffffffff1660e01b8152600401610b459190610f3a565b602060405180830381865afa158015610b60573d5f803e3d5ffd5b505050506040513d601f19601f82011682018060405250810190610b8491906112f3565b90505f610b9a8888858589896060015f610ea0565b90505f610bc08883604001518460400151858560800151610fb5565b90508092505050809550505050505095945050505050565b5f8054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610c5b576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610c52906112c1565b60405180910390fd5b5f8273ffffffffffffffffffffffffffffffffffffffff166370a08231306040518263ffffffff1660e01b8152600401610c949190610f3a565b602060405180830381865afa158015610caf573d5f803e3d5ffd5b505050506040513d601f19601f82011682018060405250810190610cd391906112f3565b90505f8111610d17576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610d0e90611368565b60405180910390fd5b8273ffffffffffffffffffffffffffffffffffffffff16636a627842335f8054906101000a900473ffffffffffffffffffffffffffffffffffffffff16836040518463ffffffff1660e01b8152600401610d709291906113a0565b5050565b60405160208152600c60208201526b14995cc810da1a5d195b1a5960a21b60408201526060810192915250565b5f80610dac8686858a610fb5565b90505f815111610dc3575f809250925050610dd8565b5f815f81518110610dd757610dd76117e9565b5b602002602001015190505f611f04610dfa91906118165b505050505050505050565b5f60149054906101000a900460ff1615610e2e576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610e2590611860565b60405180910390fd5b5f610e3886610ebb565b90508092505050949350505050565b5f33905090565b5f80610e59846113ef565b1115610e9a576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610e91906118ce565b60405180910390fd5b92915050565b5f805f90505f865111610ee8576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610edf90611936565b60405180910390fd5b5f7f794a61358d6845594f94dc1db02a252b5b4814ad73ffffffffffffffffffffffffffffffffffffffff166318160ddd6040518163ffffffff1660e01b8152600401602060405180830381865afa158015610f46573d5f803e3d5ffd5b505050506040513d601f19601f82011682018060405250810190610f6a91906112f3565b90505f90505f90508660015f0151811015610fc6575f86825f01518260028110610f9757610f966117e9565b5b602002602001015190508773ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff160361100e576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016110059061199e565b60405180910390fd5b5f811161104f576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161104690611a06565b60405180910390fd5b5f611059886113ef565b90505f61106f87836110fc90919063ffffffff16565b90505f8a83838151811061108657611085565b5b60200260200101519050828260016110a89190919063ffffffff16565b106110e8576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016110df90611a6e565b60405180910390fd5b5f6110f385856111e1565b90505f8173ffffffffffffffffffffffffffffffffffffffff166370a082318b6040518263ffffffff1660e01b81526004016111289190610f3a565b602060405180830381865afa158015611143573d5f803e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061116791906112f3565b90508581111561117c578094505f93505050506111d7565b6111908682611da290919063ffffffff16565b945084851161119f575f93505b6111b38a836111ae9190610def565b610ebb565b92508281106111d15784846111c89190610def565b94505f93505b50611db6565b5050949350505050565b5f8060149054906101000a900460ff1615611231576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161122890611860565b60405180910390fd5b61123b8383610ea0565b9050919050565b61124a61156c565b5f80611254611606565b905080826020019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff1681525050818160a0019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff168152505050919050565b5f6040518061016001604052805f73ffffffffffffffffffffffffffffffffffffffff1681526020015f73ffffffffffffffffffffffffffffffffffffffff1681526020015f73ffffffffffffffffffffffffffffffffffffffff1681526020015f73ffffffffffffffffffffffffffffffffffffffff1681526020015f8152602001600190505090565b5f8054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461146d576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611464906112c1565b60405180910390fd5b5f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff16036114db576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016114d290611b22565b60405180910390fd5b805f806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050565b5f805f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050805f806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050565b604051806101600160405280600160ff168152602001600160ff1681526020015f73ffffffffffffffffffffffffffffffffffffffff16815260200160015f0b815260200160015f0b81526020015f8152602001600160ff168152602001600160ff168152602001600160ff168152602001600160ff168152602001600160ff1681525090565b5f8082840190505f8114611653576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161164a90611b8a565b60405180910390fd5b5f611666836116629190610def565b91505092915050565b5f8183116116815781611683565b825b905092915050565b5f61169682846118ef565b905092915050565b5f6116aa8284611baa565b905092915050565b5f6116be8284611bea565b905092915050565b5f6116d28284611c1a565b905092915050565b5f6116e58284611c4a565b905092915050565b5f6116f98284611c7a565b905092915050565b5f61170d8284611caa565b905092915050565b5f6117218284611cda565b905092915050565b5f6117358284611d0a565b905092915050565b5f6117498284611d3a565b905092915050565b5f6117578383611da2565b905092915050565b5f61176b8383611db6565b905092915050565b5f61177f8383611dca565b905092915050565b5f6117938383611dde565b905092915050565b5f6117a78383611df2565b905092915050565b5f6117bb8383611e06565b905092915050565b5f6117cf8383611e1a565b905092915050565b5f6117e38383611e2e565b905092915050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52603260045260245ffd5b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f8261185b5761185a611816565b5b828204905092915050565b7f5061757365640000000000000000000000000000000000000000000000000000';

        const CONTRACT_ABI = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"router1","type":"address"},{"indexed":true,"internalType":"address","name":"router2","type":"address"},{"indexed":true,"internalType":"address","name":"tokenIn","type":"address"},{"indexed":false,"internalType":"address","name":"tokenOut","type":"address"},{"indexed":false,"internalType":"uint256","name":"profitNet","type":"uint256"},{"indexed":false,"internalType":"uint8","name":"routeType","type":"uint8"}],"name":"ArbitrageSuccess","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"token","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"EmergencyWithdraw","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"token","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"profit","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"}],"name":"FlashloanExecuted","type":"event"},{"inputs":[],"name":"AAVE_POOL","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"CAMELOT","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"SUSHISWAP","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"asset","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"premium","type":"uint256"},{"internalType":"address","name":"initiator","type":"address"},{"internalType":"bytes","name":"params","type":"bytes"}],"name":"executeOperation","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"token","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"},{"components":[{"internalType":"address","name":"router1","type":"address"},{"internalType":"address","name":"router2","type":"address"},{"internalType":"address","name":"tokenIn","type":"address"},{"internalType":"address","name":"tokenOut","type":"address"},{"internalType":"uint256","name":"minProfit","type":"uint256"},{"internalType":"uint256","name":"slippageBps","type":"uint256"}],"internalType":"struct FlashloanArbitrageV3.ArbitrageData","name":"arbData","type":"tuple"}],"name":"executeFlashloan","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"token","type":"address"}],"name":"getBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"router1","type":"address"},{"internalType":"address","name":"router2","type":"address"},{"internalType":"address","name":"tokenIn","type":"address"},{"internalType":"address","name":"tokenOut","type":"address"},{"internalType":"uint256","name":"amountIn","type":"uint256"}],"name":"simulateArbitrage","outputs":[{"internalType":"uint256","name":"estimatedProfit","type":"uint256"},{"internalType":"bool","name":"isProfitable","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"token","type":"address"}],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"withdrawETH","outputs":[],"stateMutability":"nonpayable","type":"function"},{"stateMutability":"payable","type":"receive"}];

        // ========== VARI√ÅVEIS GLOBAIS ==========
        let web3, account, contract, contractAddress;
        let scanInterval = null;
        let stats = { executions: 0, successes: 0, totalProfit: 0, bestProfit: 0 };
        let opportunities = [];
        let autoExecuteEnabled = false;

        // ========== LOGS ==========
        function addLog(msg, type = 'info') {
            const container = document.getElementById('logContainer');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            const time = new Date().toLocaleTimeString();
            entry.textContent = `[${time}] ${msg}`;
            container.appendChild(entry);
            container.scrollTop = container.scrollHeight;
            
            if (container.children.length > 50) {
                container.removeChild(container.firstChild);
            }
        }

        function clearLogs() {
            document.getElementById('logContainer').innerHTML = 
                '<div class="log-entry log-info">[LIMPO] Logs limpos</div>';
        }

        // ========== CONEX√ÉO WALLET ==========
        async function connectWallet() {
            try {
                if (typeof window.ethereum === 'undefined') {
                    alert('‚ö†Ô∏è OKX Wallet / MetaMask n√£o detectada!\n\nPor favor:\n1. Instale OKX Wallet ou MetaMask\n2. Abra este site no navegador da wallet');
                    return;
                }

                addLog('Conectando wallet...', 'info');

                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                account = accounts[0];

                web3 = new Web3(window.ethereum);

                const chainId = await web3.eth.getChainId();
                const currentChain = '0x' + chainId.toString(16);

                if (currentChain !== CONFIG.CHAIN_ID) {
                    addLog('Mudando para Arbitrum One...', 'warning');
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: CONFIG.CHAIN_ID }]
                        });
                    } catch (switchError) {
                        if (switchError.code === 4902) {
                            await window.ethereum.request({
                                method: 'wallet_addEthereumChain',
                                params: [{
                                    chainId: CONFIG.CHAIN_ID,
                                    chainName: CONFIG.CHAIN_NAME,
                                    nativeCurrency: {
                                        name: 'ETH',
                                        symbol: 'ETH',
                                        decimals: 18
                                    },
                                    rpcUrls: [CONFIG.RPC_URL],
                                    blockExplorerUrls: [CONFIG.EXPLORER]
                                }]
                            });
                        } else {
                            throw switchError;
                        }
                    }
                }

                const balance = await web3.eth.getBalance(account);
                const ethBalance = web3.utils.fromWei(balance, 'ether');

                document.getElementById('walletAddress').textContent = 
                    account.substring(0, 6) + '...' + account.substring(38);
                document.getElementById('walletBalance').textContent = 
                    parseFloat(ethBalance).toFixed(4) + ' ETH';
                document.getElementById('walletInfo').style.display = 'block';
                document.getElementById('walletStatus').className = 'pill connected';
                document.getElementById('walletStatus').textContent = '‚úÖ Conectado';
                document.getElementById('connectBtn').style.display = 'none';

                // Habilitar bot√£o de deploy
                document.getElementById('deployBtn').disabled = false;

                addLog('Carteira conectada com sucesso!', 'success');
                addLog('Fa√ßa deploy do contrato para come√ßar', 'info');

                // Verificar se j√° existe contrato deployado no localStorage
                const savedContract = localStorage.getItem('contractAddress');
                if (savedContract) {
                    addLog('Contrato encontrado no hist√≥rico: ' + savedContract, 'info');
                    contractAddress = savedContract;
                    initContract(savedContract);
                }

            } catch (error) {
                addLog('‚ùå Erro: ' + error.message, 'error');
                console.error(error);
            }
        }

        // ========== DEPLOY CONTRATO ==========
        async function deployContract() {
            if (!web3 || !account) {
                alert('Conecte a carteira primeiro!');
                return;
            }

            try {
                addLog('Iniciando deploy do contrato...', 'warning');
                document.getElementById('deployBtn').disabled = true;
                document.getElementById('deployProgress').style.display = 'block';
                document.getElementById('contractStatus').className = 'pill deploying';
                document.getElementById('contractStatus').textContent = 'üöÄ Deploying...';

                // Criar contrato
                const deployContract = new web3.eth.Contract(CONTRACT_ABI);

                // Estimar gas
                const gasEstimate = await deployContract.deploy({
                    data: CONTRACT_BYTECODE
                }).estimateGas({ from: account });

                addLog(`Gas estimado: ${gasEstimate}`, 'info');

                // Deploy
                const newContract = await deployContract.deploy({
                    data: CONTRACT_BYTECODE
                }).send({
                    from: account,
                    gas: Math.floor(gasEstimate * 1.2) // 20% a mais para seguran√ßa
                });

                contractAddress = newContract.options.address;
                
                // Salvar no localStorage
                localStorage.setItem('contractAddress', contractAddress);

                addLog('‚úÖ Contrato deployado com sucesso!', 'success');
                addLog(`Endere√ßo: ${contractAddress}`, 'success');
                addLog(`Ver no explorer: ${CONFIG.EXPLORER}/address/${contractAddress}`, 'info');

                // Inicializar contrato
                initContract(contractAddress);

                document.getElementById('deploySection').style.display = 'none';
                document.getElementById('deployProgress').style.display = 'none';

            } catch (error) {
                addLog('‚ùå Erro no deploy: ' + error.message, 'error');
                console.error(error);
                document.getElementById('deployBtn').disabled = false;
                document.getElementById('deployProgress').style.display = 'none';
                document.getElementById('contractStatus').className = 'pill disconnected';
                document.getElementById('contractStatus').textContent = '‚ùå Deploy Falhou';
            }
        }

        // ========== INICIALIZAR CONTRATO ==========
        async function initContract(address) {
            try {
                contract = new web3.eth.Contract(CONTRACT_ABI, address);

                const owner = await contract.methods.owner().call();
                
                document.getElementById('contractAddress').textContent = address;
                document.getElementById('contractOwner').textContent = 
                    owner.substring(0, 6) + '...' + owner.substring(38);

                document.getElementById('contractCard').style.display = 'block';
                document.getElementById('scannerCard').style.display = 'block';
                document.getElementById('oppCard').style.display = 'block';
                document.getElementById('statsCard').style.display = 'block';

                document.getElementById('contractStatus').className = 'pill connected';
                document.getElementById('contractStatus').textContent = '‚úÖ Ativo';

                if (owner.toLowerCase() === account.toLowerCase()) {
                    addLog('‚úÖ Voc√™ √© o owner do contrato!', 'success');
                } else {
                    addLog('‚ö†Ô∏è AVISO: Voc√™ N√ÉO √© o owner!', 'error');
                    addLog(`Owner: ${owner}`, 'warning');
                }

                // Atualizar saldos
                updateBalances();
                setInterval(updateBalances, 10000); // Atualizar a cada 10s

            } catch (error) {
                addLog('Erro ao inicializar contrato: ' + error.message, 'error');
            }
        }

        // ========== ATUALIZAR SALDOS ==========
        async function updateBalances() {
            if (!contract) return;

            try {
                const usdc = await contract.methods.getBalance(CONFIG.TOKENS.USDC.address).call();
                const usdt = await contract.methods.getBalance(CONFIG.TOKENS.USDT.address).call();
                const dai = await contract.methods.getBalance(CONFIG.TOKENS.DAI.address).call();
                const weth = await contract.methods.getBalance(CONFIG.TOKENS.WETH.address).call();

                document.getElementById('balanceUSDC').textContent = 
                    (parseFloat(usdc) / 1e6).toFixed(2);
                document.getElementById('balanceUSDT').textContent = 
                    (parseFloat(usdt) / 1e6).toFixed(2);
                document.getElementById('balanceDAI').textContent = 
                    (parseFloat(dai) / 1e18).toFixed(2);
                document.getElementById('balanceWETH').textContent = 
                    (parseFloat(weth) / 1e18).toFixed(4);

            } catch (error) {
                console.error('Erro ao atualizar saldos:', error);
            }
        }

        // ========== SAQUE ==========
        async function withdrawAll() {
            if (!contract || !account) {
                alert('Conecte a carteira e deploy o contrato primeiro!');
                return;
            }

            if (!confirm('Deseja sacar TODOS os lucros do contrato?')) {
                return;
            }

            try {
                addLog('Sacando lucros...', 'warning');

                const tokens = ['USDC', 'USDT', 'DAI', 'WETH', 'ARB'];
                let withdrawn = false;

                for (const tokenSymbol of tokens) {
                    const token = CONFIG.TOKENS[tokenSymbol];
                    const balance = await contract.methods.getBalance(token.address).call();
                    
                    if (parseFloat(balance) > 0) {
                        addLog(`Sacando ${tokenSymbol}...`, 'info');
                        
                        await contract.methods.withdraw(token.address).send({
                            from: account,
                            gas: 150000
                        });

                        const balanceFormatted = parseFloat(balance) / (10 ** token.decimals);
                        addLog(`‚úÖ ${tokenSymbol}: ${balanceFormatted.toFixed(6)} sacado!`, 'success');
                        withdrawn = true;
                    }
                }

                if (!withdrawn) {
                    addLog('Nenhum saldo para sacar', 'warning');
                } else {
                    addLog('‚úÖ Saque conclu√≠do!', 'success');
                    updateBalances();
                }

            } catch (error) {
                addLog('‚ùå Erro no saque: ' + error.message, 'error');
            }
        }

        // ========== SCANNER ==========
        async function startScanner() {
            if (!contract || !account) {
                alert('Conecte a carteira e deploy o contrato primeiro!');
                return;
            }

            if (scanInterval) {
                addLog('Scanner j√° est√° rodando!', 'warning');
                return;
            }

            autoExecuteEnabled = document.getElementById('autoExecute').checked;

            document.getElementById('startScanBtn').style.display = 'none';
            document.getElementById('stopScanBtn').style.display = 'block';
            document.getElementById('scanStatus').className = 'pill scanning';
            document.getElementById('scanStatus').textContent = 'üîÑ Scanning';

            addLog('Scanner iniciado!', 'success');
            if (autoExecuteEnabled) {
                addLog('ü§ñ AUTO-EXECU√á√ÉO ATIVADA!', 'warning');
            }

            async function scan() {
                try {
                    addLog('Escaneando mercado...', 'info');
                    document.getElementById('scanProgress').style.width = '30%';

                    opportunities = await findOpportunities();
                    
                    document.getElementById('scanProgress').style.width = '100%';
                    displayOpportunities();

                    // AUTO-EXECU√á√ÉO
                    if (autoExecuteEnabled && opportunities.length > 0) {
                        const bestOpp = opportunities[0];
                        if (bestOpp.profitPercent >= parseFloat(document.getElementById('minProfitPercent').value)) {
                            addLog('ü§ñ Auto-execu√ß√£o ativada!', 'warning');
                            addLog(`Oportunidade: ${bestOpp.pair} | Lucro: $${bestOpp.profit.toFixed(2)} (${bestOpp.profitPercent.toFixed(2)}%)`, 'info');
                            
                            // POPUP AUTOM√ÅTICO
                            if (confirm(`üöÄ OPORTUNIDADE LUCRATIVA!\n\n${bestOpp.pair}\nLucro Estimado: $${bestOpp.profit.toFixed(2)} (${bestOpp.profitPercent.toFixed(2)}%)\nRota: ${bestOpp.dex1Name} ‚Üí ${bestOpp.dex2Name}\n\nExecutar agora?`)) {
                                await executeArbitrage(0);
                            }
                        }
                    }

                    setTimeout(() => {
                        document.getElementById('scanProgress').style.width = '0%';
                    }, 1000);

                } catch (error) {
                    addLog('Erro no scan: ' + error.message, 'error');
                }
            }

            await scan();
            scanInterval = setInterval(scan, 30000);
        }

        function stopScanner() {
            if (scanInterval) {
                clearInterval(scanInterval);
                scanInterval = null;
            }

            document.getElementById('startScanBtn').style.display = 'block';
            document.getElementById('stopScanBtn').style.display = 'none';
            document.getElementById('scanStatus').className = 'pill disconnected';
            document.getElementById('scanStatus').textContent = '‚è∏Ô∏è Scan Off';

            addLog('Scanner parado', 'info');
        }

        // ========== ENCONTRAR OPORTUNIDADES ==========
        async function findOpportunities() {
            const opps = [];
            const flashAmount = parseFloat(document.getElementById('flashloanAmount').value);
            
            const pairs = [
                { tokenIn: 'USDC', tokenOut: 'USDT' },
                { tokenIn: 'USDC', tokenOut: 'DAI' },
                { tokenIn: 'USDC', tokenOut: 'WETH' },
                { tokenIn: 'USDT', tokenOut: 'USDC' },
                { tokenIn: 'WETH', tokenOut: 'USDC' },
                { tokenIn: 'WETH', tokenOut: 'ARB' },
                { tokenIn: 'ARB', tokenOut: 'USDC' },
            ];

            const dexCombos = [
                { dex1: 'SUSHISWAP', dex2: 'CAMELOT' },
                { dex1: 'CAMELOT', dex2: 'SUSHISWAP' }
            ];

            for (const pair of pairs) {
                for (const combo of dexCombos) {
                    try {
                        const tokenIn = CONFIG.TOKENS[pair.tokenIn];
                        const tokenOut = CONFIG.TOKENS[pair.tokenOut];
                        const dex1 = CONFIG.DEXS[combo.dex1];
                        const dex2 = CONFIG.DEXS[combo.dex2];

                        const amountIn = web3.utils.toBN(flashAmount).mul(
                            web3.utils.toBN(10).pow(web3.utils.toBN(tokenIn.decimals))
                        ).toString();

                        const result = await contract.methods.simulateArbitrage(
                            dex1.router,
                            dex2.router,
                            tokenIn.address,
                            tokenOut.address,
                            amountIn
                        ).call();

                        if (result.isProfitable) {
                            const profitRaw = parseFloat(result.estimatedProfit);
                            const profitUSD = profitRaw / (10 ** tokenIn.decimals);
                            const profitPercent = (profitUSD / flashAmount) * 100;

                            opps.push({
                                pair: `${pair.tokenIn}‚Üí${pair.tokenOut}`,
                                dex1Name: dex1.name,
                                dex2Name: dex2.name,
                                profit: profitUSD,
                                profitPercent: profitPercent,
                                dex1Router: dex1.router,
                                dex2Router: dex2.router,
                                tokenIn: tokenIn,
                                tokenOut: tokenOut,
                                amount: flashAmount
                            });

                            addLog(`‚úÖ ${pair.tokenIn}‚Üí${pair.tokenOut} | ${dex1.name}‚Üí${dex2.name} | $${profitUSD.toFixed(2)} (${profitPercent.toFixed(2)}%)`, 'success');
                        }

                    } catch (err) {
                        // Silenciar erros de pares sem liquidez
                    }
                }
            }

            opps.sort((a, b) => b.profit - a.profit);

            if (opps.length === 0) {
                addLog('Nenhuma oportunidade lucrativa encontrada', 'warning');
            } else {
                addLog(`${opps.length} oportunidade(s) encontrada(s)!`, 'success');
            }

            return opps;
        }

        // ========== DISPLAY OPORTUNIDADES ==========
        function displayOpportunities() {
            const container = document.getElementById('oppList');
            document.getElementById('oppCount').textContent = opportunities.length;

            if (opportunities.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; opacity: 0.5; padding: 20px;">
                        Nenhuma oportunidade encontrada.<br>
                        Aguardando pr√≥ximo scan...
                    </div>
                `;
                return;
            }

            container.innerHTML = '';

            opportunities.forEach((opp, index) => {
                const card = document.createElement('div');
                card.className = 'opp-card';
                
                const confidence = Math.min(95, 60 + (opp.profitPercent * 10));
                
                card.innerHTML = `
                    <div class="opp-header">
                        <div class="opp-title">${opp.pair}</div>
                        <div class="confidence">${confidence.toFixed(0)}%</div>
                    </div>
                    <div style="font-size: 0.8em; opacity: 0.8; margin-bottom: 8px;">
                        ${opp.dex1Name} ‚Üí ${opp.dex2Name}
                    </div>
                    <div class="opp-details">
                        <div>
                            <div style="opacity: 0.6;">Lucro</div>
                            <div style="color: #10b981; font-weight: 600;">$${opp.profit.toFixed(2)}</div>
                        </div>
                        <div>
                            <div style="opacity: 0.6;">ROI</div>
                            <div style="color: #00d4ff; font-weight: 600;">${opp.profitPercent.toFixed(2)}%</div>
                        </div>
                        <div>
                            <div style="opacity: 0.6;">Valor</div>
                            <div>$${opp.amount}</div>
                        </div>
                    </div>
                    <button class="btn btn-success" onclick="executeArbitrage(${index})">
                        ‚ö° Executar Agora
                    </button>
                `;

                container.appendChild(card);
            });
        }

        // ========== EXECUTAR ARBITRAGEM ==========
        async function executeArbitrage(index) {
            if (!contract || !account) {
                alert('Conecte a carteira e deploy o contrato primeiro!');
                return;
            }

            const opp = opportunities[index];
            if (!opp) return;

            try {
                addLog(`Executando: ${opp.pair} via ${opp.dex1Name}‚Üí${opp.dex2Name}`, 'warning');

                const amount = web3.utils.toBN(opp.amount).mul(
                    web3.utils.toBN(10).pow(web3.utils.toBN(opp.tokenIn.decimals))
                ).toString();

                const minProfitPercent = parseFloat(document.getElementById('minProfitPercent').value);
                const minProfit = web3.utils.toBN(opp.amount).mul(
                    web3.utils.toBN(Math.floor(minProfitPercent * 100))
                ).div(web3.utils.toBN(10000)).mul(
                    web3.utils.toBN(10).pow(web3.utils.toBN(opp.tokenIn.decimals))
                ).toString();

                const slippageBps = Math.floor(parseFloat(document.getElementById('slippageBps').value) * 100);

                const arbData = {
                    router1: opp.dex1Router,
                    router2: opp.dex2Router,
                    tokenIn: opp.tokenIn.address,
                    tokenOut: opp.tokenOut.address,
                    minProfit: minProfit,
                    slippageBps: slippageBps
                };

                addLog('Enviando transa√ß√£o...', 'info');

                const tx = await contract.methods.executeFlashloan(
                    opp.tokenIn.address,
                    amount,
                    arbData
                ).send({
                    from: account,
                    gas: 1200000
                });

                addLog(`‚úÖ SUCESSO! TX: ${tx.transactionHash.substring(0,10)}...`, 'success');
                addLog(`Ver: ${CONFIG.EXPLORER}/tx/${tx.transactionHash}`, 'info');

                stats.executions++;
                stats.successes++;
                stats.totalProfit += opp.profit;
                if (opp.profit > stats.bestProfit) {
                    stats.bestProfit = opp.profit;
                }
                updateStats();
                updateBalances();

            } catch (error) {
                addLog(`‚ùå ERRO: ${error.message}`, 'error');
                stats.executions++;
                updateStats();
            }
        }

        // ========== ATUALIZAR STATS ==========
        function updateStats() {
            document.getElementById('statExecutions').textContent = stats.executions;
            document.getElementById('statSuccesses').textContent = stats.successes;
            document.getElementById('statProfit').textContent = '$' + stats.totalProfit.toFixed(2);
            document.getElementById('statBest').textContent = '$' + stats.bestProfit.toFixed(2);
        }

        // ========== INICIALIZA√á√ÉO ==========
        window.addEventListener('load', () => {
            addLog('Sistema carregado e pronto!', 'success');
            addLog('Rede: Arbitrum One', 'info');
            addLog('Passo 1: Conectar wallet', 'info');
            addLog('Passo 2: Deploy do contrato', 'info');
            addLog('Passo 3: Iniciar scanner', 'info');
        });

        // Auto-conectar se j√° autorizado
        if (typeof window.ethereum !== 'undefined') {
            window.ethereum.request({ method: 'eth_accounts' })
                .then(accounts => {
                    if (accounts.length > 0) {
                        connectWallet();
                    }
                });
        }

        // Atualizar checkbox auto-execute
        document.getElementById('autoExecute').addEventListener('change', (e) => {
            autoExecuteEnabled = e.target.checked;
            if (autoExecuteEnabled) {
                addLog('ü§ñ Auto-execu√ß√£o ATIVADA!', 'warning');
            } else {
                addLog('Auto-execu√ß√£o desativada', 'info');
            }
        });
    </script>
</body>
</html>
