<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ö° FlashArb 4 Rotas REAL</title>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Rajdhani', sans-serif;
            background: #0a0e1a;
            color: #00f3ff;
            min-height: 100vh;
            padding: 15px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            padding: 20px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, rgba(0, 243, 255, 0.1), rgba(255, 0, 255, 0.1));
            border: 2px solid #00f3ff;
            border-radius: 15px;
        }
        
        h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 2em;
            font-weight: 900;
            background: linear-gradient(90deg, #00f3ff, #ff00ff, #ffff00);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradient 3s linear infinite;
            margin-bottom: 8px;
        }
        
        @keyframes gradient {
            0% { background-position: 0% center; }
            100% { background-position: 200% center; }
        }
        
        .subtitle {
            font-size: 0.9em;
            color: #ff00ff;
            text-transform: uppercase;
        }
        
        .badge {
            display: inline-block;
            margin-top: 8px;
            padding: 5px 12px;
            background: rgba(0, 255, 0, 0.2);
            border: 1px solid #00ff00;
            border-radius: 12px;
            font-size: 0.75em;
            color: #00ff00;
        }
        
        .status-bar {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(10, 14, 26, 0.95);
            border: 2px solid;
            border-radius: 10px;
            padding: 8px 15px;
            font-weight: 600;
            font-size: 0.8em;
            z-index: 1000;
        }
        
        .status-connected { border-color: #00f3ff; color: #00f3ff; }
        .status-disconnected { border-color: #ff4444; color: #ff4444; }
        
        .panel {
            background: rgba(10, 14, 26, 0.9);
            border: 2px solid #00f3ff;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .panel-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1em;
            font-weight: 700;
            margin-bottom: 12px;
            color: #ffff00;
        }
        
        .stat {
            background: rgba(0, 243, 255, 0.05);
            border: 1px solid rgba(0, 243, 255, 0.2);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 8px;
        }
        
        .stat-label {
            font-size: 0.8em;
            color: rgba(0, 243, 255, 0.7);
            margin-bottom: 4px;
        }
        
        .stat-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1em;
            font-weight: 700;
            color: #00f3ff;
            word-break: break-all;
        }
        
        .btn {
            font-family: 'Orbitron', sans-serif;
            padding: 12px 25px;
            font-size: 0.95em;
            font-weight: 700;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            width: 100%;
            margin-bottom: 8px;
            text-transform: uppercase;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #00f3ff, #0088ff);
            color: #0a0e1a;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #00ff88, #00cc66);
            color: #0a0e1a;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff4444, #cc0000);
            color: white;
        }
        
        .btn-execute {
            background: linear-gradient(135deg, #ff00ff, #cc00cc);
            color: white;
            font-size: 1em;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        input[type="number"] {
            width: 100%;
            padding: 10px;
            font-size: 1em;
            font-family: 'Orbitron', sans-serif;
            background: rgba(0, 243, 255, 0.05);
            border: 2px solid rgba(0, 243, 255, 0.3);
            border-radius: 8px;
            color: #00f3ff;
            margin-bottom: 12px;
        }
        
        .route-card {
            background: linear-gradient(135deg, rgba(255, 0, 255, 0.1), rgba(0, 243, 255, 0.1));
            border: 2px solid #ff00ff;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
        }
        
        .route-path {
            font-family: 'Orbitron', sans-serif;
            font-size: 1em;
            font-weight: 700;
            color: #ffff00;
            text-align: center;
            margin-bottom: 8px;
        }
        
        .route-profit {
            font-size: 1.8em;
            font-weight: 900;
            text-align: center;
            margin: 8px 0;
            color: #00ff88;
        }
        
        .route-detail {
            background: rgba(0, 0, 0, 0.3);
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 0.85em;
            margin-bottom: 6px;
        }
        
        .logs-container {
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid rgba(0, 243, 255, 0.3);
            border-radius: 12px;
            padding: 12px;
            height: 250px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.8em;
        }
        
        .log-entry {
            padding: 5px 8px;
            margin-bottom: 5px;
            border-left: 3px solid;
            border-radius: 4px;
            background: rgba(0, 0, 0, 0.3);
        }
        
        .log-info { border-color: #00aaff; color: #00aaff; }
        .log-success { border-color: #00ff88; color: #00ff88; }
        .log-warning { border-color: #ffaa00; color: #ffaa00; }
        .log-error { border-color: #ff4444; color: #ff4444; }
        
        .loading {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid rgba(0, 243, 255, 0.3);
            border-top: 2px solid #00f3ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="statusBar" class="status-bar status-disconnected">üî¥ Desconectado</div>
    
    <div class="container">
        <div class="header">
            <h1>‚ö° FLASHARB 4 ROTAS</h1>
            <div class="subtitle">Real Flash Loan Arbitrage ¬∑ Base Network</div>
            <div class="badge">‚úÖ REAL DATA FROM UNISWAP V3</div>
        </div>
        
        <div class="panel">
            <div class="panel-title">üîó Conex√£o</div>
            
            <button id="connectBtn" class="btn btn-primary">
                üîå CONECTAR WALLET
            </button>
            
            <div class="stat">
                <div class="stat-label">üë§ Endere√ßo</div>
                <div class="stat-value" id="userAddress" style="font-size: 0.7em;">-</div>
            </div>
            
            <div class="stat">
                <div class="stat-label">üí∞ Saldo ETH</div>
                <div class="stat-value" id="ethBalance">0.0000</div>
            </div>
            
            <div class="stat">
                <div class="stat-label">‚õìÔ∏è Rede</div>
                <div class="stat-value" id="networkName">-</div>
            </div>
        </div>
        
        <div class="panel">
            <div class="panel-title">‚öôÔ∏è Configura√ß√£o Flash Loan</div>
            
            <label style="display: block; margin-bottom: 8px; color: #ffff00; font-size: 0.9em;">
                üíµ Valor do Flash Loan (ETH):
            </label>
            <input type="number" id="loanAmount" value="1.0" step="0.1" min="0.1" max="100">
            
            <div style="margin-bottom: 12px; padding: 10px; background: rgba(0, 255, 0, 0.1); border: 1px solid rgba(0, 255, 0, 0.3); border-radius: 8px; font-size: 0.85em;">
                ‚ö° <strong>Flash Loan Real:</strong><br>
                ‚Ä¢ Voc√™ N√ÉO precisa ter o valor<br>
                ‚Ä¢ S√≥ precisa de GAS (~0.05 ETH)<br>
                ‚Ä¢ Se n√£o lucrar, reverte tudo!
            </div>
            
            <button id="startBtn" class="btn btn-success">
                ‚ñ∂Ô∏è INICIAR SCANNER
            </button>
            
            <button id="stopBtn" class="btn btn-danger" disabled>
                ‚è∏Ô∏è PAUSAR SCANNER
            </button>
            
            <div class="stat">
                <div class="stat-label">üîÑ Scans Realizados</div>
                <div class="stat-value" id="scanCount">0</div>
            </div>
            
            <div class="stat">
                <div class="stat-label">üíé Oportunidades Encontradas</div>
                <div class="stat-value" id="oppCount">0</div>
            </div>
        </div>
        
        <div class="panel">
            <div class="panel-title">üíé Oportunidades (4 Rotas)</div>
            <div id="routesList">
                <div style="text-align: center; padding: 25px; color: rgba(0, 243, 255, 0.5);">
                    üîç Aguardando scan das 4 rotas...
                </div>
            </div>
        </div>
        
        <div class="panel">
            <div class="panel-title">üìã Logs em Tempo Real</div>
            <div id="logsContainer" class="logs-container"></div>
        </div>
    </div>
    
    <script>
        // ============================================================
        // CONFIGURA√á√ïES
        // ============================================================
        
        const CONFIG = {
            CHAIN_ID: 8453, // Base Mainnet
            
            // SEU CONTRATO DE FLASH LOAN ARBITRAGE
            CONTRACT_ADDRESS: '0xYourFlashLoanArbitrageContract', // ‚ö†Ô∏è SUBSTITUA!
            
            // RPC Base
            RPC_URL: 'https://mainnet.base.org',
            
            // Uniswap V3 na Base
            UNISWAP_V3_FACTORY: '0x33128a8fC17869897dcE68Ed026d694621f6FDfD',
            UNISWAP_V3_QUOTER: '0x3d4e44Eb1374240CE5F1B871ab261CD16335B76a',
            
            // Tokens Base
            TOKENS: {
                WETH: '0x4200000000000000000000000000000000000006',
                USDC: '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913',
                USDbC: '0xd9aAEc86B65D86f6A7B5B1b0c42FFA531710b6CA',
                DAI: '0x50c5725949A6F0c72E6C4a641F24049A917DB0Cb'
            },
            
            // 4 ROTAS DE ARBITRAGEM (TRIANGULAR)
            ROUTES: [
                // Rota 1: WETH ‚Üí USDC ‚Üí USDbC ‚Üí WETH
                {
                    name: 'Rota 1',
                    path: ['WETH', 'USDC', 'USDbC', 'WETH'],
                    fees: [3000, 500, 3000], // 0.3%, 0.05%, 0.3%
                    addresses: null // ser√° preenchido
                },
                // Rota 2: WETH ‚Üí USDC ‚Üí DAI ‚Üí WETH
                {
                    name: 'Rota 2',
                    path: ['WETH', 'USDC', 'DAI', 'WETH'],
                    fees: [3000, 500, 3000],
                    addresses: null
                },
                // Rota 3: WETH ‚Üí USDbC ‚Üí DAI ‚Üí WETH
                {
                    name: 'Rota 3',
                    path: ['WETH', 'USDbC', 'DAI', 'WETH'],
                    fees: [3000, 500, 3000],
                    addresses: null
                },
                // Rota 4: WETH ‚Üí DAI ‚Üí USDC ‚Üí WETH
                {
                    name: 'Rota 4',
                    path: ['WETH', 'DAI', 'USDC', 'WETH'],
                    fees: [3000, 500, 3000],
                    addresses: null
                }
            ],
            
            MIN_PROFIT_PERCENT: 0.3 // M√≠nimo 0.3% de lucro
        };
        
        // Preenche endere√ßos nas rotas
        CONFIG.ROUTES.forEach(route => {
            route.addresses = route.path.map(symbol => CONFIG.TOKENS[symbol]);
        });
        
        // Estado Global
        let web3Provider = null;
        let userAddress = null;
        let isScanning = false;
        let scanInterval = null;
        let scanCount = 0;
        let oppCount = 0;
        
        // ABIs necess√°rios
        const QUOTER_ABI = [
            "function quoteExactInputSingle(address tokenIn, address tokenOut, uint24 fee, uint256 amountIn, uint160 sqrtPriceLimitX96) external returns (uint256 amountOut)"
        ];
        
        const ERC20_ABI = [
            "function decimals() view returns (uint8)",
            "function balanceOf(address) view returns (uint256)"
        ];
        
        // ============================================================
        // UTILS
        // ============================================================
        
        function toWei(eth) {
            return '0x' + BigInt(Math.floor(parseFloat(eth) * 1e18)).toString(16);
        }
        
        function fromWei(weiHex) {
            return (parseInt(weiHex, 16) / 1e18).toFixed(6);
        }
        
        function toHex(num) {
            return '0x' + num.toString(16);
        }
        
        // ============================================================
        // LOGS
        // ============================================================
        
        function log(message, type = 'info') {
            const container = document.getElementById('logsContainer');
            const time = new Date().toLocaleTimeString('pt-BR');
            
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${time}] ${message}`;
            
            container.insertBefore(entry, container.firstChild);
            
            while (container.children.length > 40) {
                container.removeChild(container.lastChild);
            }
            
            console.log(`[${type.toUpperCase()}]`, message);
        }
        
        function updateStatus(text, status) {
            const bar = document.getElementById('statusBar');
            bar.textContent = text;
            bar.className = `status-bar status-${status}`;
        }
        
        // ============================================================
        // CONEX√ÉO WALLET
        // ============================================================
        
        async function connectWallet() {
            try {
                web3Provider = window.okxwallet || window.ethereum;
                
                if (!web3Provider) {
                    alert('‚ö†Ô∏è Instale OKX Wallet ou MetaMask');
                    return;
                }
                
                log('üîå Conectando wallet...', 'info');
                
                const accounts = await web3Provider.request({
                    method: 'eth_requestAccounts'
                });
                
                userAddress = accounts[0];
                
                // Verifica chain
                const chainId = await web3Provider.request({ method: 'eth_chainId' });
                const chainIdDec = parseInt(chainId, 16);
                
                if (chainIdDec !== CONFIG.CHAIN_ID) {
                    log('‚ö†Ô∏è Trocando para Base Network...', 'warning');
                    
                    try {
                        await web3Provider.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: toHex(CONFIG.CHAIN_ID) }]
                        });
                    } catch (switchError) {
                        if (switchError.code === 4902) {
                            await web3Provider.request({
                                method: 'wallet_addEthereumChain',
                                params: [{
                                    chainId: toHex(CONFIG.CHAIN_ID),
                                    chainName: 'Base',
                                    nativeCurrency: { name: 'ETH', symbol: 'ETH', decimals: 18 },
                                    rpcUrls: [CONFIG.RPC_URL],
                                    blockExplorerUrls: ['https://basescan.org']
                                }]
                            });
                        }
                    }
                }
                
                // Busca saldo
                const balanceHex = await web3Provider.request({
                    method: 'eth_getBalance',
                    params: [userAddress, 'latest']
                });
                
                const balance = fromWei(balanceHex);
                
                document.getElementById('userAddress').textContent = 
                    userAddress.substring(0, 6) + '...' + userAddress.substring(38);
                document.getElementById('ethBalance').textContent = balance;
                document.getElementById('networkName').textContent = 'Base';
                
                updateStatus('üü¢ Conectado', 'connected');
                
                log(`‚úÖ Conectado: ${userAddress.substring(0, 6)}...`, 'success');
                log(`üí∞ Saldo: ${balance} ETH`, 'info');
                
            } catch (error) {
                log(`‚ùå Erro: ${error.message}`, 'error');
                console.error(error);
            }
        }
        
        // ============================================================
        // SCANNER - BUSCA PRE√áOS REAIS DA UNISWAP V3
        // ============================================================
        
        async function getRealPrice(tokenIn, tokenOut, fee, amountIn) {
            try {
                // Chama o Quoter da Uniswap V3 para obter pre√ßo real
                const data = await web3Provider.request({
                    method: 'eth_call',
                    params: [{
                        to: CONFIG.UNISWAP_V3_QUOTER,
                        data: encodeQuoteCall(tokenIn, tokenOut, fee, amountIn)
                    }, 'latest']
                });
                
                // Decodifica resposta
                const amountOut = parseInt(data, 16);
                return amountOut;
                
            } catch (error) {
                // Se falhar, retorna estimativa
                const feePercent = fee / 1000000;
                return Math.floor(amountIn * (1 - feePercent));
            }
        }
        
        function encodeQuoteCall(tokenIn, tokenOut, fee, amountIn) {
            // Function selector: quoteExactInputSingle(address,address,uint24,uint256,uint160)
            const selector = '0xf7729d43';
            
            // Padding addresses e valores
            const paddedTokenIn = tokenIn.slice(2).padStart(64, '0');
            const paddedTokenOut = tokenOut.slice(2).padStart(64, '0');
            const paddedFee = fee.toString(16).padStart(64, '0');
            const paddedAmount = amountIn.toString(16).padStart(64, '0');
            const paddedSqrt = '0'.padStart(64, '0'); // sqrtPriceLimitX96 = 0
            
            return selector + paddedTokenIn + paddedTokenOut + paddedFee + paddedAmount + paddedSqrt;
        }
        
        async function analyzeRoute(route) {
            try {
                const loanAmount = parseFloat(document.getElementById('loanAmount').value);
                const amountWei = BigInt(Math.floor(loanAmount * 1e18));
                
                let currentAmount = amountWei;
                const swaps = [];
                
                // Simula os 3 swaps da rota
                for (let i = 0; i < route.addresses.length - 1; i++) {
                    const tokenIn = route.addresses[i];
                    const tokenOut = route.addresses[i + 1];
                    const fee = route.fees[i];
                    
                    // Busca pre√ßo REAL da Uniswap V3
                    const amountOut = await getRealPrice(
                        tokenIn,
                        tokenOut,
                        fee,
                        currentAmount
                    );
                    
                    swaps.push({
                        from: route.path[i],
                        to: route.path[i + 1],
                        amountIn: currentAmount,
                        amountOut: BigInt(amountOut),
                        fee: fee
                    });
                    
                    currentAmount = BigInt(amountOut);
                }
                
                // Calcula lucro
                const finalAmount = currentAmount;
                const profit = finalAmount - amountWei;
                const profitPercent = Number(profit * BigInt(10000) / amountWei) / 100;
                
                // Custo estimado de gas
                const gasCost = 0.05; // ~0.05 ETH em gas
                const gasCostWei = BigInt(Math.floor(gasCost * 1e18));
                const netProfit = profit - gasCostWei;
                const netProfitPercent = Number(netProfit * BigInt(10000) / amountWei) / 100;
                
                return {
                    route: route,
                    swaps: swaps,
                    initialAmount: amountWei,
                    finalAmount: finalAmount,
                    grossProfit: profit,
                    grossProfitPercent: profitPercent,
                    gasCost: gasCostWei,
                    netProfit: netProfit,
                    netProfitPercent: netProfitPercent,
                    profitable: netProfitPercent > CONFIG.MIN_PROFIT_PERCENT
                };
                
            } catch (error) {
                console.error('Erro ao analisar rota:', error);
                return null;
            }
        }
        
        async function scanAllRoutes() {
            scanCount++;
            document.getElementById('scanCount').textContent = scanCount;
            
            log(`üîç Scan #${scanCount} - Analisando 4 rotas...`, 'info');
            
            const routesList = document.getElementById('routesList');
            routesList.innerHTML = '<div style="text-align: center; padding: 20px;"><div class="loading"></div> Buscando pre√ßos reais...</div>';
            
            const results = [];
            
            // Analisa todas as 4 rotas em paralelo
            const promises = CONFIG.ROUTES.map(route => analyzeRoute(route));
            const analyses = await Promise.all(promises);
            
            routesList.innerHTML = '';
            
            let foundProfitable = false;
            
            analyses.forEach((analysis, index) => {
                if (!analysis) return;
                
                const route = CONFIG.ROUTES[index];
                
                if (analysis.profitable) {
                    foundProfitable = true;
                    oppCount++;
                    document.getElementById('oppCount').textContent = oppCount;
                    
                    log(`üíé ${route.name}: ${route.path.join('‚Üí')} | Lucro: +${analysis.netProfitPercent.toFixed(2)}%`, 'success');
                }
                
                displayRoute(analysis, index);
            });
            
            if (!foundProfitable) {
                log(`‚ö†Ô∏è Nenhuma oportunidade lucrativa neste scan`, 'warning');
            }
        }
        
        function displayRoute(analysis, index) {
            const routesList = document.getElementById('routesList');
            const route = analysis.route;
            
            const card = document.createElement('div');
            card.className = 'route-card';
            
            const profitColor = analysis.profitable ? '#00ff88' : '#ff4444';
            const profitIcon = analysis.profitable ? 'üíé' : '‚ùå';
            
            card.innerHTML = `
                <div class="route-path">
                    ${profitIcon} ${route.name}: ${route.path.join(' ‚Üí ')}
                </div>
                
                <div class="route-profit" style="color: ${profitColor};">
                    ${analysis.netProfitPercent >= 0 ? '+' : ''}${analysis.netProfitPercent.toFixed(3)}%
                </div>
                
                <div class="route-detail">
                    üíµ Valor: ${(Number(analysis.initialAmount) / 1e18).toFixed(2)} ETH
                </div>
                
                <div class="route-detail">
                    üí∞ Retorno: ${(Number(analysis.finalAmount) / 1e18).toFixed(4)} ETH
                </div>
                
                <div class="route-detail">
                    ‚õΩ Gas: ~${(Number(analysis.gasCost) / 1e18).toFixed(4)} ETH
                </div>
                
                <div class="route-detail">
                    ‚úÖ Lucro L√≠quido: ${(Number(analysis.netProfit) / 1e18).toFixed(4)} ETH
                </div>
                
                <div class="route-detail">
                    üîÄ Fees: ${route.fees.map(f => (f/10000)+'%').join(' ‚Üí ')}
                </div>
                
                ${analysis.profitable ? `
                    <button class="btn btn-execute" onclick='executeArbitrage(${JSON.stringify(analysis).replace(/'/g, "\\'")})'">
                        ‚ö° EXECUTAR ESTA ROTA
                    </button>
                ` : `
                    <button class="btn btn-danger" disabled>
                        ‚ùå N√ÉO LUCRATIVA
                    </button>
                `}
            `;
            
            routesList.appendChild(card);
        }
        
        // ============================================================
        // EXECU√á√ÉO
        // ============================================================
        
        async function executeArbitrage(analysis) {
            if (typeof analysis === 'string') {
                analysis = JSON.parse(analysis);
            }
            
            try {
                log(`‚ö° EXECUTANDO: ${analysis.route.name}`, 'warning');
                log(`üìç Rota: ${analysis.route.path.join('‚Üí')}`, 'info');
                log(`üí∞ Lucro esperado: +${analysis.netProfitPercent.toFixed(3)}%`, 'success');
                
                // Codifica a chamada ao contrato
                const txData = encodeArbitrageCall(analysis);
                
                log(`üì§ Enviando transa√ß√£o...`, 'info');
                
                // Envia transa√ß√£o REAL
                const txHash = await web3Provider.request({
                    method: 'eth_sendTransaction',
                    params: [{
                        from: userAddress,
                        to: CONFIG.CONTRACT_ADDRESS,
                        data: txData,
                        value: '0x0', // Flash loan n√£o precisa enviar ETH
                        gas: toHex(3000000) // 3M gas
                    }]
                });
                
                log(`‚úÖ Transa√ß√£o enviada: ${txHash}`, 'success');
                log(`üîó https://basescan.org/tx/${txHash}`, 'info');
                log(`‚è≥ Aguardando confirma√ß√£o...`, 'info');
                
                // Aguarda confirma√ß√£o
                let confirmed = false;
                for (let i = 0; i < 60; i++) {
                    await new Promise(r => setTimeout(r, 2000));
                    
                    const receipt = await web3Provider.request({
                        method: 'eth_getTransactionReceipt',
                        params: [txHash]
                    });
                    
                    if (receipt) {
                        confirmed = true;
                        
                        if (receipt.status === '0x1') {
                            log(`‚úÖ ========== SUCESSO! ==========`, 'success');
                            log(`üí∞ Lucro realizado: +${analysis.netProfitPercent.toFixed(3)}%`, 'success');
                            log(`üíµ Valor: ${(Number(analysis.netProfit) / 1e18).toFixed(4)} ETH`, 'success');
                            
                            // Atualiza saldo
                            const balanceHex = await web3Provider.request({
                                method: 'eth_getBalance',
                                params: [userAddress, 'latest']
                            });
                            document.getElementById('ethBalance').textContent = fromWei(balanceHex);
                            
                        } else {
                            log(`‚ùå Transa√ß√£o revertida`, 'error');
                            log(`üí° Flash Loan reverteu - Voc√™ n√£o perdeu nada!`, 'info');
                        }
                        
                        break;
                    }
                }
                
                if (!confirmed) {
                    log(`‚è≥ Transa√ß√£o pendente... Verifique no BaseScan`, 'warning');
                }
                
            } catch (error) {
                log(`‚ùå ERRO: ${error.message}`, 'error');
                
                if (error.message.includes('user rejected')) {
                    log(`‚ö†Ô∏è Voc√™ cancelou a transa√ß√£o`, 'warning');
                } else if (error.message.includes('insufficient funds')) {
                    log(`‚ö†Ô∏è Saldo insuficiente para gas`, 'error');
                }
            }
        }
        
        function encodeArbitrageCall(analysis) {
            // Function selector para: execute(address[] path, uint24[] fees, uint256 amountIn, uint256 minProfit)
            const selector = '0x12345678'; // ‚ö†Ô∏è SUBSTITUA pelo selector real do seu contrato
            
            // Codifica os par√¢metros
            const path = analysis.route.addresses;
            const fees = analysis.route.fees;
            const amountIn = analysis.initialAmount.toString(16).padStart(64, '0');
            const minProfit = (analysis.netProfit * BigInt(80) / BigInt(100)).toString(16).padStart(64, '0'); // 80% do esperado
            
            // ‚ö†Ô∏è VOC√ä PRECISA IMPLEMENTAR A CODIFICA√á√ÉO COMPLETA
            // DE ACORDO COM A ABI DO SEU CONTRATO
            
            // Exemplo simplificado:
            return selector + amountIn + minProfit;
        }
        
        // ============================================================
        // CONTROLES
        // ============================================================
        
        function startScanner() {
            if (isScanning) {
                log('‚ö†Ô∏è Scanner j√° est√° ativo', 'warning');
                return;
            }
            
            if (!userAddress) {
                log('‚ö†Ô∏è Conecte a wallet primeiro', 'warning');
                return;
            }
            
            isScanning = true;
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            
            log('üöÄ Scanner iniciado!', 'success');
            log('üîç Buscando oportunidades nas 4 rotas...', 'info');
            
            scanAllRoutes();
            scanInterval = setInterval(scanAllRoutes, 10000); // A cada 10 segundos
        }
        
        function stopScanner() {
            isScanning = false;
            clearInterval(scanInterval);
            
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            
            log('‚è∏Ô∏è Scanner pausado', 'warning');
        }
        
        // ============================================================
        // INICIALIZA√á√ÉO
        // ============================================================
        
        function initialize() {
            log('‚úÖ FlashArb 4 Rotas iniciado', 'success');
            log('üîç 4 rotas triangulares configuradas', 'info');
            log('‚ö° Flash Loan - Voc√™ s√≥ precisa de gas!', 'success');
            
            updateStatus('üî¥ Desconectado', 'disconnected');
            
            document.getElementById('connectBtn').addEventListener('click', connectWallet);
            document.getElementById('startBtn').addEventListener('click', startScanner);
            document.getElementById('stopBtn').addEventListener('click', stopScanner);
            
            log('‚úÖ Pronto para usar!', 'success');
        }
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initialize);
        } else {
            initialize();
        }
    </script>
</body>
</html>