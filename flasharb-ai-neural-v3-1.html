<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ö° FlashArb Neural AI v3.0 - Real Base Scanner</title>
    
    <!-- Bibliotecas DEVEM carregar primeiro -->
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.11.0/dist/tf.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600&display=swap');
        
        :root {
            --neon-cyan: #00f3ff;
            --neon-magenta: #ff00ff;
            --neon-yellow: #ffff00;
            --dark-void: #0a0e1a;
            --darker-void: #050810;
            --grid-color: rgba(0, 243, 255, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--darker-void);
            color: var(--neon-cyan);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }
        
        /* Animated Grid Background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(var(--grid-color) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: gridMove 20s linear infinite;
            pointer-events: none;
            z-index: 0;
        }
        
        @keyframes gridMove {
            0% { background-position: 0 0; }
            100% { background-position: 50px 50px; }
        }
        
        /* Glowing orbs */
        .orb {
            position: fixed;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.3;
            pointer-events: none;
            z-index: 1;
        }
        
        .orb-1 {
            width: 400px;
            height: 400px;
            background: var(--neon-cyan);
            top: -200px;
            left: -200px;
            animation: float1 15s ease-in-out infinite;
        }
        
        .orb-2 {
            width: 300px;
            height: 300px;
            background: var(--neon-magenta);
            bottom: -150px;
            right: -150px;
            animation: float2 12s ease-in-out infinite;
        }
        
        @keyframes float1 {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(100px, 50px); }
        }
        
        @keyframes float2 {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(-80px, -60px); }
        }
        
        .container {
            position: relative;
            z-index: 10;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header */
        .header {
            text-align: center;
            padding: 30px 20px;
            margin-bottom: 30px;
            background: linear-gradient(135deg, rgba(0, 243, 255, 0.05), rgba(255, 0, 255, 0.05));
            border: 2px solid var(--neon-cyan);
            border-radius: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--neon-cyan), var(--neon-magenta), var(--neon-yellow));
            border-radius: 20px;
            opacity: 0;
            z-index: -1;
            transition: opacity 0.3s;
        }
        
        .header:hover::before {
            opacity: 0.3;
        }
        
        h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 3em;
            font-weight: 900;
            background: linear-gradient(90deg, var(--neon-cyan), var(--neon-magenta), var(--neon-yellow), var(--neon-cyan));
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 3s linear infinite;
            text-shadow: 0 0 40px rgba(0, 243, 255, 0.5);
            margin-bottom: 10px;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% center; }
            100% { background-position: 200% center; }
        }
        
        .subtitle {
            font-size: 1.2em;
            color: var(--neon-magenta);
            letter-spacing: 2px;
            text-transform: uppercase;
        }
        
        .ai-badge {
            display: inline-block;
            margin-top: 10px;
            padding: 8px 20px;
            background: rgba(255, 0, 255, 0.2);
            border: 1px solid var(--neon-magenta);
            border-radius: 20px;
            font-size: 0.9em;
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 0, 255, 0.5); }
            50% { box-shadow: 0 0 20px rgba(255, 0, 255, 0.8); }
        }
        
        /* Status Bar */
        .status-bar {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(10, 14, 26, 0.95);
            border: 2px solid;
            border-radius: 15px;
            padding: 15px 25px;
            font-weight: 600;
            font-size: 1em;
            z-index: 1000;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
        }
        
        .status-connected {
            border-color: var(--neon-cyan);
            color: var(--neon-cyan);
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.4);
        }
        
        .status-disconnected {
            border-color: #ff4444;
            color: #ff4444;
        }
        
        /* Grid Layout */
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 968px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Panel */
        .panel {
            background: rgba(10, 14, 26, 0.8);
            border: 2px solid var(--neon-cyan);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 243, 255, 0.1), transparent);
            transition: left 0.5s;
        }
        
        .panel:hover::before {
            left: 100%;
        }
        
        .panel:hover {
            border-color: var(--neon-magenta);
            box-shadow: 0 0 30px rgba(0, 243, 255, 0.3);
        }
        
        .panel h2 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5em;
            margin-bottom: 20px;
            color: var(--neon-yellow);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .panel-full {
            grid-column: 1 / -1;
        }
        
        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 1em;
            color: var(--neon-cyan);
        }
        
        input[type="number"],
        input[type="text"],
        select {
            width: 100%;
            padding: 12px;
            background: rgba(0, 243, 255, 0.05);
            border: 2px solid var(--neon-cyan);
            border-radius: 10px;
            color: var(--neon-cyan);
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.1em;
            transition: all 0.3s;
        }
        
        input:focus,
        select:focus {
            outline: none;
            border-color: var(--neon-magenta);
            box-shadow: 0 0 15px rgba(255, 0, 255, 0.3);
            background: rgba(255, 0, 255, 0.05);
        }
        
        /* Buttons */
        .btn {
            width: 100%;
            padding: 15px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1em;
            font-weight: 700;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-magenta));
            color: var(--darker-void);
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn-primary:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .btn-primary:hover {
            box-shadow: 0 0 30px rgba(0, 243, 255, 0.6);
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff4444, #cc0000);
            color: white;
        }
        
        .btn-danger:hover {
            box-shadow: 0 0 30px rgba(255, 68, 68, 0.6);
        }
        
        .btn-execute {
            background: linear-gradient(135deg, var(--neon-yellow), #ff8800);
            color: var(--darker-void);
            font-size: 1em;
            padding: 12px;
        }
        
        .btn-execute:hover {
            box-shadow: 0 0 30px rgba(255, 255, 0, 0.6);
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: rgba(0, 243, 255, 0.05);
            border: 2px solid var(--neon-cyan);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.8em;
            font-weight: 700;
            color: var(--neon-yellow);
            display: block;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        /* AI Status */
        .ai-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: rgba(255, 0, 255, 0.1);
            border: 2px solid var(--neon-magenta);
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .ai-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--neon-magenta);
            animation: blink 1s ease-in-out infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        /* Opportunities */
        .opportunity-card {
            background: linear-gradient(135deg, rgba(0, 243, 255, 0.05), rgba(255, 0, 255, 0.05));
            border: 2px solid var(--neon-cyan);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .opportunity-card:hover {
            border-color: var(--neon-magenta);
            box-shadow: 0 0 30px rgba(255, 0, 255, 0.3);
            transform: translateY(-3px);
        }
        
        .opp-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .opp-route {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2em;
            font-weight: 700;
            color: var(--neon-cyan);
        }
        
        .profit-badge {
            padding: 8px 15px;
            background: linear-gradient(135deg, var(--neon-yellow), #ff8800);
            color: var(--darker-void);
            border-radius: 20px;
            font-weight: 700;
            font-size: 1.1em;
        }
        
        .confidence-bar {
            height: 8px;
            background: rgba(0, 243, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--neon-cyan), var(--neon-magenta));
            border-radius: 10px;
            transition: width 1s ease-out;
        }
        
        .opp-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
            font-size: 0.95em;
        }
        
        .opp-detail {
            background: rgba(0, 0, 0, 0.3);
            padding: 8px;
            border-radius: 8px;
            border-left: 3px solid var(--neon-cyan);
        }
        
        /* Terminal */
        .terminal {
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid var(--neon-cyan);
            border-radius: 10px;
            padding: 15px;
            height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        .terminal::-webkit-scrollbar {
            width: 8px;
        }
        
        .terminal::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }
        
        .terminal::-webkit-scrollbar-thumb {
            background: var(--neon-cyan);
            border-radius: 4px;
        }
        
        .log {
            margin-bottom: 5px;
            padding: 5px;
            border-radius: 3px;
        }
        
        .log-info { color: var(--neon-cyan); }
        .log-success { color: #00ff00; background: rgba(0, 255, 0, 0.1); }
        .log-warning { color: var(--neon-yellow); background: rgba(255, 255, 0, 0.1); }
        .log-error { color: #ff4444; background: rgba(255, 68, 68, 0.1); }
        .log-ai { color: var(--neon-magenta); background: rgba(255, 0, 255, 0.1); }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--dark-void);
            border: 3px solid var(--neon-cyan);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 0 60px rgba(0, 243, 255, 0.5);
            animation: modalZoom 0.3s ease-out;
        }
        
        @keyframes modalZoom {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .modal h2 {
            font-family: 'Orbitron', sans-serif;
            text-align: center;
            margin-bottom: 25px;
            font-size: 1.8em;
            color: var(--neon-yellow);
        }
        
        .modal-detail {
            background: rgba(0, 243, 255, 0.05);
            border: 1px solid var(--neon-cyan);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .modal-detail strong {
            color: var(--neon-yellow);
            display: block;
            margin-bottom: 5px;
        }
        
        .modal-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 25px;
        }
        
        /* Balance Info */
        .balance-info {
            display: none;
            background: rgba(0, 243, 255, 0.1);
            border: 2px solid var(--neon-cyan);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .balance-info.active {
            display: block;
        }
        
        .balance-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .balance-value {
            font-weight: 700;
            color: var(--neon-yellow);
        }
        
        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0, 243, 255, 0.3);
            border-top-color: var(--neon-cyan);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Neural Network Visualization */
        .neural-viz {
            position: relative;
            height: 100px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .neural-node {
            position: absolute;
            width: 8px;
            height: 8px;
            background: var(--neon-magenta);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--neon-magenta);
            animation: nodeFloat 3s ease-in-out infinite;
        }
        
        @keyframes nodeFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .neural-connection {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--neon-cyan), transparent);
            opacity: 0.5;
            animation: connectionPulse 2s ease-in-out infinite;
        }
        
        @keyframes connectionPulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.8; }
        }
    </style>
</head>
<body>
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    
    <div id="statusBar" class="status-bar status-disconnected">üî¥ Desconectado</div>
    
    <div class="container">
        <div class="header">
            <h1>‚ö° FLASHARB NEURAL AI</h1>
            <div class="subtitle">v3.0 ¬∑ Real-Time Base Network Scanner</div>
            <div class="ai-badge">üß† Powered by TensorFlow.js Neural Network</div>
        </div>
        
        <div class="grid">
            <!-- Wallet Panel -->
            <div class="panel">
                <h2>üîê Conex√£o</h2>
                <button id="connectBtn" class="btn btn-primary">üîó CONECTAR WALLET</button>
                
                <div id="balanceInfo" class="balance-info">
                    <div class="balance-row">
                        <span>üìç Endere√ßo:</span>
                        <span id="userAddress" class="balance-value">-</span>
                    </div>
                    <div class="balance-row">
                        <span>üí∞ Saldo ETH:</span>
                        <span id="ethBalance" class="balance-value">0.0000</span>
                    </div>
                    <div class="balance-row">
                        <span>‚õìÔ∏è Network:</span>
                        <span class="balance-value">Base Mainnet</span>
                    </div>
                </div>
            </div>
            
            <!-- AI Status Panel -->
            <div class="panel">
                <h2>üß† Status da IA</h2>
                <div class="ai-status">
                    <div class="ai-indicator"></div>
                    <span id="aiStatus">Modelo Neural Carregado ‚úì</span>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <span id="poolsScanned" class="stat-value">0</span>
                        <span class="stat-label">Pools Scanned</span>
                    </div>
                    <div class="stat-card">
                        <span id="opportunitiesFound" class="stat-value">0</span>
                        <span class="stat-label">Opps Found</span>
                    </div>
                    <div class="stat-card">
                        <span id="aiConfidence" class="stat-value">0%</span>
                        <span class="stat-label">AI Confidence</span>
                    </div>
                </div>
                
                <div class="neural-viz" id="neuralViz"></div>
            </div>
        </div>
        
        <!-- Configuration Panel -->
        <div class="panel panel-full">
            <h2>‚öôÔ∏è Configura√ß√£o do Scanner</h2>
            
            <div class="grid">
                <div class="form-group">
                    <label>üíµ Valor para Trade (ETH)</label>
                    <input type="number" id="tradeAmount" value="0.01" step="0.001" min="0.001">
                </div>
                
                <div class="form-group">
                    <label>üìä Lucro M√≠nimo (%)</label>
                    <input type="number" id="minProfit" value="0.5" step="0.1" min="0.1">
                </div>
                
                <div class="form-group">
                    <label>üß† Threshold de Confian√ßa AI (%)</label>
                    <input type="number" id="aiThreshold" value="75" step="5" min="50" max="100">
                </div>
                
                <div class="form-group">
                    <label>‚ö° Intervalo de Scan (segundos)</label>
                    <select id="scanInterval">
                        <option value="10">10 segundos</option>
                        <option value="15" selected>15 segundos</option>
                        <option value="30">30 segundos</option>
                        <option value="60">60 segundos</option>
                    </select>
                </div>
            </div>
            
            <!-- AVISO IMPORTANTE -->
            <div style="background: rgba(0, 255, 0, 0.1); border: 2px solid var(--neon-cyan); border-radius: 10px; padding: 15px; margin-top: 20px;">
                <div style="font-weight: 700; color: var(--neon-cyan); margin-bottom: 10px; font-size: 1.1em;">
                    ‚ö° VERDADEIRO FLASH LOAN - S√ì PRECISA DE GAS!
                </div>
                <div style="font-size: 0.95em; line-height: 1.6;">
                    <div style="margin-bottom: 8px;">
                        ‚úì <strong>Voc√™ S√ì precisa</strong> de ~0.06 ETH para gas (20 gwei)
                    </div>
                    <div style="margin-bottom: 8px;">
                        ‚úì <strong>Flash Loan</strong> pega emprestado o capital automaticamente
                    </div>
                    <div style="margin-bottom: 8px;">
                        ‚úì <strong>4 Pools</strong> usadas: 1 flash + 3 swaps triangulares
                    </div>
                    <div style="margin-bottom: 8px;">
                        ‚úì <strong>Lucro</strong> √© enviado para sua wallet
                    </div>
                    <div style="margin-bottom: 8px;">
                        ‚úì <strong>Preju√≠zo</strong> reverte tudo - voc√™ n√£o perde nada!
                    </div>
                    <div style="color: var(--neon-yellow); margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--neon-cyan);">
                        ‚öôÔ∏è Gas: 3M limit @ 20 gwei * 1.2 = 24 gwei (~0.06 ETH por trade)
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 20px;">
                <button id="startBtn" class="btn btn-primary">üöÄ INICIAR SCANNER NEURAL</button>
                <button id="stopBtn" class="btn btn-danger" style="display: none; margin-top: 10px;">‚èπÔ∏è PARAR SCANNER</button>
            </div>
        </div>
        
        <!-- Opportunities Panel -->
        <div class="panel panel-full">
            <h2>üíé Oportunidades Detectadas pela IA</h2>
            <div id="opportunitiesList">
                <div style="text-align: center; opacity: 0.5; padding: 40px;">
                    <div style="font-size: 3em; margin-bottom: 10px;">üîç</div>
                    <div>Aguardando scanner neural...</div>
                </div>
            </div>
        </div>
        
        <!-- Terminal Panel -->
        <div class="panel panel-full">
            <h2>üìü Terminal de Logs</h2>
            <div id="terminal" class="terminal">
                <div class="log log-success">[SISTEMA] FlashArb Neural AI v3.0 inicializado</div>
                <div class="log log-ai">[IA] Modelo TensorFlow.js carregado com sucesso</div>
                <div class="log log-info">[REDE] Configurado para Base Mainnet (Chain ID: 8453)</div>
            </div>
        </div>
    </div>
    
    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <h2>‚ö° Confirmar Execu√ß√£o</h2>
            
            <div class="modal-detail">
                <strong>üîÄ Rota de Arbitragem:</strong>
                <span id="modalRoute">-</span>
            </div>
            
            <div class="modal-detail">
                <strong>üí∞ Valor do Trade:</strong>
                <span id="modalAmount">-</span>
            </div>
            
            <div class="modal-detail">
                <strong>üìà Lucro Estimado:</strong>
                <span id="modalProfit">-</span>
            </div>
            
            <div class="modal-detail">
                <strong>üß† Confian√ßa da IA:</strong>
                <span id="modalConfidence">-</span>
            </div>
            
            <div class="modal-detail">
                <strong>‚õΩ Gas Estimado:</strong>
                <span id="modalGas">-</span>
            </div>
            
            <div class="modal-buttons">
                <button class="btn btn-danger" onclick="closeModal()">‚ùå Cancelar</button>
                <button class="btn btn-primary" onclick="confirmExecution()">‚úÖ Executar</button>
            </div>
        </div>
    </div>
    
    <script>
        // DEBUG: Verifica se bibliotecas carregaram
        console.log('=== VERIFICA√á√ÉO DE BIBLIOTECAS ===');
        console.log('typeof ethers:', typeof ethers);
        console.log('typeof tf:', typeof tf);
        
        // Aguarda bibliotecas carregarem (j√° est√£o no <head>)
        function checkLibraries() {
            console.log('checkLibraries() chamado');
            return new Promise((resolve) => {
                // Se j√° carregou, resolve imediatamente
                if (typeof ethers !== 'undefined' && typeof tf !== 'undefined') {
                    console.log('‚úÖ Bibliotecas j√° carregadas!');
                    resolve();
                    return;
                }
                
                // Sen√£o, aguarda carregar
                console.log('‚è≥ Aguardando bibliotecas...');
                let attempts = 0;
                const checkInterval = setInterval(() => {
                    attempts++;
                    console.log(`Tentativa ${attempts}: ethers=${typeof ethers}, tf=${typeof tf}`);
                    
                    if (typeof ethers !== 'undefined' && typeof tf !== 'undefined') {
                        console.log('‚úÖ Bibliotecas carregadas!');
                        clearInterval(checkInterval);
                        resolve();
                    }
                    
                    if (attempts > 50) { // 5 segundos
                        console.error('‚ùå Timeout aguardando bibliotecas!');
                        clearInterval(checkInterval);
                        alert('ERRO: Ethers.js ou TensorFlow.js n√£o carregaram. Recarregue a p√°gina.');
                    }
                }, 100);
            });
        }
        
        // ============================================================
        // CONFIGURA√á√ÉO E CONSTANTES
        // ============================================================
        
        const CONFIG = {
            BASE_CHAIN_ID: 8453,
            CONTRACT_ADDRESS: '0x36b4fe14e1de330728cdd56b16b7560d9326f372',
            RPC_URL: 'https://mainnet.base.org',
            FACTORY_ADDRESS: '0x33128a8fC17869897dcE68Ed026d694621f6FDfD',
            GAS_LIMIT: 3000000,  // 3M gas para 4 pools (flash + 3 swaps)
            GAS_PRICE_GWEI: 20,  // 20 gwei base
            GAS_MULTIPLIER: 1.2  // 20% boost = 24 gwei final
        };
        
        const TOKENS = [
            { 
                symbol: 'WETH', 
                address: '0x4200000000000000000000000000000000000006',
                decimals: 18
            },
            { 
                symbol: 'USDC', 
                address: '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913',
                decimals: 6
            },
            { 
                symbol: 'DAI', 
                address: '0x50c5725949A6F0c72E6C4a641F24049A917DB0Cb',
                decimals: 18
            },
            {
                symbol: 'USDbC',
                address: '0xd9aAEc86B65D86f6A7B5B1b0c42FFA531710b6CA',
                decimals: 6
            },
            {
                symbol: 'cbETH',
                address: '0x2Ae3F1Ec7F1F5012CFEab0185bfc7aa3cf0DEc22',
                decimals: 18
            }
        ];
        
        const FEES = [500, 3000, 10000]; // 0.05%, 0.3%, 1%
        
        // üìä ROTAS POSS√çVEIS:
        // - 5 tokens = 60 combina√ß√µes triangulares (A‚ÜíB‚ÜíC‚ÜíA)
        // - 3 fees por hop = 27 varia√ß√µes por rota
        // - Total: 60 * 27 = 1,620 rotas poss√≠veis!
        // - Scanner IA analisa todas e escolhe as melhores
        
        const CONTRACT_ABI = [
            "function execute(address tokenA, uint256 amountIn, address tokenB, uint24 fee1, uint24 fee2, uint24 fee3, address tokenC, uint256 minProfit) external returns (uint256)",
            "function getStats() external view returns (uint256 executions, uint256 successes, uint256 profit)"
        ];
        
        const POOL_ABI = [
            "function slot0() external view returns (uint160 sqrtPriceX96, int24 tick, uint16 observationIndex, uint16 observationCardinality, uint16 observationCardinalityNext, uint8 feeProtocol, bool unlocked)",
            "function liquidity() external view returns (uint128)",
            "function token0() external view returns (address)",
            "function token1() external view returns (address)"
        ];
        
        const FACTORY_ABI = [
            "function getPool(address tokenA, address tokenB, uint24 fee) external view returns (address pool)"
        ];
        
        // ============================================================
        // VARI√ÅVEIS GLOBAIS
        // ============================================================
        
        let provider, signer, userAddress, contract, factoryContract;
        let rpcProvider; // Provider somente leitura para scanning
        let isScanning = false;
        let scannerInterval;
        let currentOpportunity = null;
        let neuralModel = null;
        
        // Estat√≠sticas
        let stats = {
            poolsScanned: 0,
            opportunitiesFound: 0,
            avgConfidence: 0
        };
        
        // ============================================================
        // FUN√á√ïES AUXILIARES
        // ============================================================
        
        function log(msg, type = 'info') {
            const terminal = document.getElementById('terminal');
            const line = document.createElement('div');
            line.className = `log log-${type}`;
            const timestamp = new Date().toLocaleTimeString('pt-BR');
            line.textContent = `[${timestamp}] ${msg}`;
            terminal.appendChild(line);
            terminal.scrollTop = terminal.scrollHeight;
            
            // Limita a 100 linhas
            while (terminal.children.length > 100) {
                terminal.removeChild(terminal.firstChild);
            }
        }
        
        function updateStatus(text, type) {
            const status = document.getElementById('statusBar');
            status.textContent = text;
            status.className = `status-bar status-${type}`;
        }
        
        function updateStats() {
            document.getElementById('poolsScanned').textContent = stats.poolsScanned;
            document.getElementById('opportunitiesFound').textContent = stats.opportunitiesFound;
            document.getElementById('aiConfidence').textContent = 
                stats.avgConfidence > 0 ? stats.avgConfidence.toFixed(0) + '%' : '0%';
        }
        
        // ============================================================
        // NEURAL NETWORK - TensorFlow.js
        // ============================================================
        
        async function initNeuralNetwork() {
            try {
                log('üß† Inicializando rede neural...', 'ai');
                
                // Cria um modelo sequencial simples
                neuralModel = tf.sequential({
                    layers: [
                        tf.layers.dense({ inputShape: [6], units: 16, activation: 'relu' }),
                        tf.layers.dropout({ rate: 0.2 }),
                        tf.layers.dense({ units: 8, activation: 'relu' }),
                        tf.layers.dense({ units: 1, activation: 'sigmoid' })
                    ]
                });
                
                neuralModel.compile({
                    optimizer: tf.train.adam(0.001),
                    loss: 'binaryCrossentropy',
                    metrics: ['accuracy']
                });
                
                // Treina com dados sint√©ticos iniciais (seria substitu√≠do por dados reais)
                await trainWithSyntheticData();
                
                log('‚úÖ Rede neural treinada e pronta!', 'success');
                createNeuralVisualization();
                
            } catch (error) {
                log(`‚ùå Erro ao inicializar IA: ${error.message}`, 'error');
            }
        }
        
        async function trainWithSyntheticData() {
            // Gera dados sint√©ticos para treinamento inicial
            // Features: [profit%, spread%, liquidity_ratio, gas_cost, price_impact, volatility]
            const xs = tf.randomNormal([100, 6]);
            const ys = tf.randomUniform([100, 1]);
            
            await neuralModel.fit(xs, ys, {
                epochs: 5,
                verbose: 0
            });
            
            xs.dispose();
            ys.dispose();
        }
        
        function predictProfitability(features) {
            // Features esperadas: [profit%, spread%, liquidityRatio, gasCost, priceImpact, volatility]
            if (!neuralModel) return 50;
            
            const inputTensor = tf.tensor2d([features]);
            const prediction = neuralModel.predict(inputTensor);
            const confidence = prediction.dataSync()[0] * 100;
            
            inputTensor.dispose();
            prediction.dispose();
            
            return confidence;
        }
        
        function createNeuralVisualization() {
            const viz = document.getElementById('neuralViz');
            viz.innerHTML = '';
            
            // Cria n√≥s visuais
            for (let i = 0; i < 12; i++) {
                const node = document.createElement('div');
                node.className = 'neural-node';
                node.style.left = `${(i * 8) + 5}%`;
                node.style.top = `${45 + Math.sin(i) * 20}px`;
                node.style.animationDelay = `${i * 0.1}s`;
                viz.appendChild(node);
            }
            
            // Cria conex√µes visuais
            for (let i = 0; i < 10; i++) {
                const conn = document.createElement('div');
                conn.className = 'neural-connection';
                conn.style.left = `${i * 9}%`;
                conn.style.top = `${50 + Math.random() * 30}px`;
                conn.style.width = '8%';
                conn.style.animationDelay = `${i * 0.15}s`;
                viz.appendChild(conn);
            }
        }
        
        // ============================================================
        // CONEX√ÉO WALLET
        // ============================================================
        
        async function connectWallet() {
            try {
                if (!window.ethereum) {
                    alert('‚ùå Por favor, instale MetaMask ou OKX Wallet!');
                    return;
                }
                
                log('üîÑ Conectando wallet...', 'info');
                updateStatus('üü° Conectando...', 'disconnected');
                
                provider = new ethers.providers.Web3Provider(window.ethereum);
                await provider.send("eth_requestAccounts", []);
                signer = provider.getSigner();
                userAddress = await signer.getAddress();
                
                // Verifica/muda para Base
                const network = await provider.getNetwork();
                if (network.chainId !== CONFIG.BASE_CHAIN_ID) {
                    log('‚ö†Ô∏è Mudando para rede Base...', 'warning');
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: '0x2105' }]
                        });
                    } catch (switchError) {
                        if (switchError.code === 4902) {
                            await window.ethereum.request({
                                method: 'wallet_addEthereumChain',
                                params: [{
                                    chainId: '0x2105',
                                    chainName: 'Base',
                                    nativeCurrency: { name: 'ETH', symbol: 'ETH', decimals: 18 },
                                    rpcUrls: ['https://mainnet.base.org'],
                                    blockExplorerUrls: ['https://basescan.org']
                                }]
                            });
                        }
                    }
                    // Reconecta ap√≥s mudan√ßa de rede
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    signer = provider.getSigner();
                }
                
                // Cria inst√¢ncia do contrato
                contract = new ethers.Contract(CONFIG.CONTRACT_ADDRESS, CONTRACT_ABI, signer);
                
                // Atualiza UI
                const balance = await provider.getBalance(userAddress);
                const ethBalance = ethers.utils.formatEther(balance);
                
                document.getElementById('ethBalance').textContent = parseFloat(ethBalance).toFixed(4);
                document.getElementById('userAddress').textContent = 
                    userAddress.substring(0, 6) + '...' + userAddress.substring(38);
                document.getElementById('balanceInfo').classList.add('active');
                document.getElementById('connectBtn').style.display = 'none';
                
                updateStatus('üü¢ Conectado', 'connected');
                log(`‚úÖ Conectado: ${userAddress}`, 'success');
                log(`üí∞ Saldo: ${parseFloat(ethBalance).toFixed(4)} ETH`, 'success');
                
                // VERIFICA√á√ÉO DE SALDO PARA GAS
                if (parseFloat(ethBalance) < 0.005) {
                    log(`‚ö†Ô∏è Saldo baixo para gas!`, 'warning');
                    log(`üí∞ Recomendado: pelo menos 0.01 ETH para m√∫ltiplos trades`, 'info');
                } else {
                    log(`‚úÖ Saldo suficiente para executar trades!`, 'success');
                    log(`‚ö° Flash Loan cobre o capital - voc√™ s√≥ paga gas!`, 'ai');
                }
                
            } catch (error) {
                log(`‚ùå Erro ao conectar: ${error.message}`, 'error');
                updateStatus('üî¥ Erro na conex√£o', 'disconnected');
            }
        }
        
        // ============================================================
        // SCANNER DE POOLS REAIS
        // ============================================================
        
        async function initRpcProvider() {
            rpcProvider = new ethers.providers.JsonRpcProvider(CONFIG.RPC_URL);
            factoryContract = new ethers.Contract(CONFIG.FACTORY_ADDRESS, FACTORY_ABI, rpcProvider);
            log('‚úÖ RPC Provider inicializado', 'success');
        }
        
        async function getPoolData(tokenA, tokenB, fee) {
            try {
                const poolAddress = await factoryContract.getPool(
                    tokenA.address,
                    tokenB.address,
                    fee
                );
                
                if (poolAddress === ethers.constants.AddressZero) {
                    return null;
                }
                
                const poolContract = new ethers.Contract(poolAddress, POOL_ABI, rpcProvider);
                
                const [slot0, liquidity] = await Promise.all([
                    poolContract.slot0(),
                    poolContract.liquidity()
                ]);
                
                return {
                    address: poolAddress,
                    sqrtPriceX96: slot0.sqrtPriceX96,
                    tick: slot0.tick,
                    liquidity: liquidity,
                    fee: fee
                };
                
            } catch (error) {
                return null;
            }
        }
        
        function calculatePrice(sqrtPriceX96, decimals0, decimals1) {
            const Q96 = ethers.BigNumber.from(2).pow(96);
            const price = sqrtPriceX96.mul(sqrtPriceX96).div(Q96);
            const decimalAdjustment = ethers.BigNumber.from(10).pow(decimals0 - decimals1);
            return parseFloat(ethers.utils.formatUnits(price.mul(decimalAdjustment), decimals1));
        }
        
        async function scanTriangularArbitrage() {
            if (!rpcProvider) {
                await initRpcProvider();
            }
            
            log('üîç Escaneando pools triangulares...', 'ai');
            
            const opportunities = [];
            
            // Gera todas as combina√ß√µes triangulares poss√≠veis
            for (let i = 0; i < TOKENS.length; i++) {
                for (let j = 0; j < TOKENS.length; j++) {
                    if (i === j) continue;
                    
                    for (let k = 0; k < TOKENS.length; k++) {
                        if (k === i || k === j) continue;
                        
                        const tokenA = TOKENS[i];
                        const tokenB = TOKENS[j];
                        const tokenC = TOKENS[k];
                        
                        // Testa diferentes combina√ß√µes de fees
                        for (const fee1 of FEES) {
                            for (const fee2 of FEES) {
                                for (const fee3 of FEES) {
                                    try {
                                        const opp = await analyzeRoute(
                                            tokenA, tokenB, tokenC,
                                            fee1, fee2, fee3
                                        );
                                        
                                        if (opp) {
                                            opportunities.push(opp);
                                        }
                                        
                                        stats.poolsScanned++;
                                        
                                    } catch (error) {
                                        // Silenciosamente ignora pools inexistentes
                                    }
                                }
                            }
                        }
                    }
                }
            }
            
            updateStats();
            
            if (opportunities.length > 0) {
                // Ordena por confian√ßa da IA
                opportunities.sort((a, b) => b.aiConfidence - a.aiConfidence);
                
                const minProfit = parseFloat(document.getElementById('minProfit').value);
                const minConfidence = parseFloat(document.getElementById('aiThreshold').value);
                
                const validOpps = opportunities.filter(
                    o => o.profit >= minProfit && o.aiConfidence >= minConfidence
                );
                
                if (validOpps.length > 0) {
                    stats.opportunitiesFound++;
                    displayOpportunity(validOpps[0]);
                    log(`üíé Oportunidade encontrada: +${validOpps[0].profit.toFixed(3)}% (Confian√ßa: ${validOpps[0].aiConfidence.toFixed(0)}%)`, 'success');
                }
            }
            
            log(`üìä Scan completo: ${stats.poolsScanned} pools analisadas`, 'info');
        }
        
        async function analyzeRoute(tokenA, tokenB, tokenC, fee1, fee2, fee3) {
            // Busca dados das 3 pools
            const [pool1, pool2, pool3] = await Promise.all([
                getPoolData(tokenA, tokenB, fee1),
                getPoolData(tokenB, tokenC, fee2),
                getPoolData(tokenC, tokenA, fee3)
            ]);
            
            if (!pool1 || !pool2 || !pool3) {
                return null;
            }
            
            // Verifica liquidez m√≠nima
            const minLiquidity = ethers.utils.parseEther('1');
            if (pool1.liquidity.lt(minLiquidity) || 
                pool2.liquidity.lt(minLiquidity) || 
                pool3.liquidity.lt(minLiquidity)) {
                return null;
            }
            
            // Calcula pre√ßos
            const price1 = calculatePrice(pool1.sqrtPriceX96, tokenA.decimals, tokenB.decimals);
            const price2 = calculatePrice(pool2.sqrtPriceX96, tokenB.decimals, tokenC.decimals);
            const price3 = calculatePrice(pool3.sqrtPriceX96, tokenC.decimals, tokenA.decimals);
            
            // Calcula profit estimado
            const tradeAmount = parseFloat(document.getElementById('tradeAmount').value);
            let currentAmount = tradeAmount;
            
            // Simula os 3 swaps
            currentAmount = currentAmount * price1 * (1 - fee1 / 1000000);
            currentAmount = currentAmount * price2 * (1 - fee2 / 1000000);
            currentAmount = currentAmount * price3 * (1 - fee3 / 1000000);
            
            const profit = ((currentAmount - tradeAmount) / tradeAmount) * 100;
            
            if (profit <= 0) {
                return null;
            }
            
            // Calcula spread e volatilidade
            const spread = Math.abs(price1 * price2 * price3 - 1) * 100;
            const volatility = calculateVolatility([price1, price2, price3]);
            
            // Estima impacto de pre√ßo
            const priceImpact = estimatePriceImpact(tradeAmount, pool1.liquidity);
            
            // Calcula custo de gas
            const gasCost = await estimateGasCost();
            
            // Calcula ratio de liquidez
            const avgLiquidity = (
                parseFloat(ethers.utils.formatEther(pool1.liquidity)) +
                parseFloat(ethers.utils.formatEther(pool2.liquidity)) +
                parseFloat(ethers.utils.formatEther(pool3.liquidity))
            ) / 3;
            const liquidityRatio = Math.min(avgLiquidity / 100, 1); // Normaliza
            
            // IA prediz confian√ßa
            const features = [
                profit,
                spread,
                liquidityRatio,
                gasCost,
                priceImpact,
                volatility
            ];
            
            const aiConfidence = predictProfitability(features);
            
            // Atualiza m√©dia de confian√ßa
            if (stats.avgConfidence === 0) {
                stats.avgConfidence = aiConfidence;
            } else {
                stats.avgConfidence = (stats.avgConfidence * 0.9) + (aiConfidence * 0.1);
            }
            
            return {
                tokenA,
                tokenB,
                tokenC,
                fee1,
                fee2,
                fee3,
                profit,
                spread,
                aiConfidence,
                liquidity: avgLiquidity,
                priceImpact,
                gasCost,
                pools: [pool1.address, pool2.address, pool3.address]
            };
        }
        
        function calculateVolatility(prices) {
            const mean = prices.reduce((a, b) => a + b) / prices.length;
            const variance = prices.reduce((sum, price) => sum + Math.pow(price - mean, 2), 0) / prices.length;
            return Math.sqrt(variance) * 100;
        }
        
        function estimatePriceImpact(tradeAmount, liquidity) {
            const liquidityEth = parseFloat(ethers.utils.formatEther(liquidity));
            return Math.min((tradeAmount / liquidityEth) * 100, 5);
        }
        
        async function estimateGasCost() {
            // Usa gas fixo: 20 gwei * 1.2 multiplier * 3M gas limit
            const baseGasPrice = ethers.utils.parseUnits(CONFIG.GAS_PRICE_GWEI.toString(), 'gwei');
            const boostedGasPrice = baseGasPrice.mul(Math.floor(CONFIG.GAS_MULTIPLIER * 100)).div(100);
            const gasCost = boostedGasPrice.mul(CONFIG.GAS_LIMIT);
            return parseFloat(ethers.utils.formatEther(gasCost));
        }
        
        // ============================================================
        // CONTROLE DO SCANNER
        // ============================================================
        
        function startScanner() {
            if (isScanning) return;
            
            isScanning = true;
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('stopBtn').style.display = 'block';
            
            log('üöÄ Scanner neural iniciado!', 'success');
            log('üß† IA analisando oportunidades em tempo real...', 'ai');
            
            const interval = parseInt(document.getElementById('scanInterval').value) * 1000;
            
            // Primeiro scan imediato
            setTimeout(() => scanTriangularArbitrage(), 2000);
            
            // Scans peri√≥dicos
            scannerInterval = setInterval(() => {
                scanTriangularArbitrage();
            }, interval);
        }
        
        function stopScanner() {
            isScanning = false;
            clearInterval(scannerInterval);
            
            document.getElementById('startBtn').style.display = 'block';
            document.getElementById('stopBtn').style.display = 'none';
            
            log('‚èπÔ∏è Scanner parado', 'warning');
        }
        
        // ============================================================
        // DISPLAY DE OPORTUNIDADES
        // ============================================================
        
        function displayOpportunity(opp) {
            const list = document.getElementById('opportunitiesList');
            
            // Remove placeholder
            if (list.querySelector('div[style*="opacity"]')) {
                list.innerHTML = '';
            }
            
            const card = document.createElement('div');
            card.className = 'opportunity-card';
            
            card.innerHTML = `
                <div class="opp-header">
                    <div class="opp-route">${opp.tokenA.symbol} ‚Üí ${opp.tokenB.symbol} ‚Üí ${opp.tokenC.symbol}</div>
                    <div class="profit-badge">+${opp.profit.toFixed(3)}%</div>
                </div>
                
                <div class="confidence-bar">
                    <div class="confidence-fill" style="width: ${opp.aiConfidence}%"></div>
                </div>
                <div style="text-align: center; margin-bottom: 15px; color: var(--neon-magenta); font-weight: 600;">
                    üß† Confian√ßa IA: ${opp.aiConfidence.toFixed(1)}%
                </div>
                
                <div class="opp-details">
                    <div class="opp-detail">
                        üìä Spread: <strong>${opp.spread.toFixed(3)}%</strong>
                    </div>
                    <div class="opp-detail">
                        üíß Liquidez: <strong>${opp.liquidity.toFixed(2)} ETH</strong>
                    </div>
                    <div class="opp-detail">
                        üìâ Impacto: <strong>${opp.priceImpact.toFixed(3)}%</strong>
                    </div>
                    <div class="opp-detail">
                        ‚õΩ Gas: <strong>${opp.gasCost.toFixed(6)} ETH</strong>
                    </div>
                    <div class="opp-detail" style="grid-column: 1 / -1;">
                        üîÄ Fees: <strong>${opp.fee1/10000}% ‚Üí ${opp.fee2/10000}% ‚Üí ${opp.fee3/10000}%</strong>
                    </div>
                </div>
                
                <button class="btn btn-execute" onclick='prepareExecution(${JSON.stringify(opp).replace(/'/g, "\\'")})'">
                    ‚ö° EXECUTAR ARBITRAGEM
                </button>
            `;
            
            list.insertBefore(card, list.firstChild);
            
            // Limita a 3 oportunidades exibidas
            while (list.children.length > 3) {
                list.removeChild(list.lastChild);
            }
        }
        
        // ============================================================
        // EXECU√á√ÉO
        // ============================================================
        
        async function prepareExecution(opp) {
            if (typeof opp === 'string') {
                opp = JSON.parse(opp);
            }
            
            if (!userAddress) {
                log('üîó Conecte a wallet primeiro!', 'warning');
                await connectWallet();
                await new Promise(r => setTimeout(r, 2000));
                if (!userAddress) return;
            }
            
            currentOpportunity = opp;
            
            try {
                // Gas: 20 gwei base * 1.2 multiplier = 24 gwei
                const baseGasPrice = ethers.utils.parseUnits(CONFIG.GAS_PRICE_GWEI.toString(), 'gwei');
                const boostedGasPrice = baseGasPrice.mul(Math.floor(CONFIG.GAS_MULTIPLIER * 100)).div(100);
                const gasInEth = ethers.utils.formatUnits(boostedGasPrice.mul(CONFIG.GAS_LIMIT), 'ether');
                const tradeAmount = document.getElementById('tradeAmount').value;
                
                document.getElementById('modalRoute').textContent = 
                    `${opp.tokenA.symbol} ‚Üí ${opp.tokenB.symbol} ‚Üí ${opp.tokenC.symbol}`;
                document.getElementById('modalAmount').textContent = tradeAmount + ' ETH (via Flash Loan)';
                document.getElementById('modalProfit').textContent = '+' + opp.profit.toFixed(3) + '%';
                document.getElementById('modalConfidence').textContent = opp.aiConfidence.toFixed(1) + '%';
                document.getElementById('modalGas').textContent = parseFloat(gasInEth).toFixed(6) + ' ETH (24 gwei)';
                
                document.getElementById('confirmModal').classList.add('active');
                log('üìã Modal de confirma√ß√£o aberto', 'info');
                
            } catch (error) {
                log(`‚ùå Erro ao preparar: ${error.message}`, 'error');
            }
        }
        
        function closeModal() {
            document.getElementById('confirmModal').classList.remove('active');
            currentOpportunity = null;
            log('‚ùå Execu√ß√£o cancelada pelo usu√°rio', 'warning');
        }
        
        async function confirmExecution() {
            document.getElementById('confirmModal').classList.remove('active');
            
            if (!currentOpportunity) return;
            
            const opp = currentOpportunity;
            
            try {
                log(`‚ö° ========== EXECUTANDO ARBITRAGEM ==========`, 'warning');
                log(`üìç Rota: ${opp.tokenA.symbol} ‚Üí ${opp.tokenB.symbol} ‚Üí ${opp.tokenC.symbol}`, 'ai');
                log(`üß† Confian√ßa IA: ${opp.aiConfidence.toFixed(1)}%`, 'ai');
                
                const tradeAmount = document.getElementById('tradeAmount').value;
                const amountIn = ethers.utils.parseEther(tradeAmount);
                
                // Calcula lucro m√≠nimo baseado no lucro estimado
                const minProfitPercent = opp.profit * 0.8; // 80% do estimado
                const minProfit = ethers.utils.parseEther(
                    (parseFloat(tradeAmount) * minProfitPercent / 100).toFixed(18)
                );
                
                // Gas: 20 gwei * 1.2 = 24 gwei
                const baseGasPrice = ethers.utils.parseUnits(CONFIG.GAS_PRICE_GWEI.toString(), 'gwei');
                const boostedGasPrice = baseGasPrice.mul(Math.floor(CONFIG.GAS_MULTIPLIER * 100)).div(100);
                
                log(`‚õΩ Gas: ${CONFIG.GAS_PRICE_GWEI} gwei * ${CONFIG.GAS_MULTIPLIER} = ${ethers.utils.formatUnits(boostedGasPrice, 'gwei')} gwei`, 'info');
                log(`üî¢ Gas Limit: ${CONFIG.GAS_LIMIT.toLocaleString()} (4 pools: 1 flash + 3 swaps)`, 'info');
                log(`üì§ Enviando transa√ß√£o para o contrato...`, 'info');
                
                const tx = await contract.execute(
                    opp.tokenA.address,
                    amountIn,
                    opp.tokenB.address,
                    opp.fee1,
                    opp.fee2,
                    opp.fee3,
                    opp.tokenC.address,
                    minProfit,
                    {
                        // ‚ö° FLASH LOAN - N√ÉO precisa enviar ETH!
                        gasLimit: CONFIG.GAS_LIMIT,
                        gasPrice: boostedGasPrice
                    }
                );
                
                log(`‚úÖ Transa√ß√£o enviada: ${tx.hash}`, 'success');
                log(`‚è≥ Aguardando confirma√ß√£o on-chain...`, 'info');
                
                const receipt = await tx.wait();
                
                if (receipt.status === 1) {
                    log(`‚úÖ ========== SUCESSO! ==========`, 'success');
                    log(`üí∞ Lucro realizado: ~${opp.profit.toFixed(3)}%`, 'success');
                    log(`üîó https://basescan.org/tx/${tx.hash}`, 'success');
                    log(`üß† IA estava ${opp.aiConfidence.toFixed(1)}% confiante`, 'ai');
                    
                    // Atualiza saldo
                    const balance = await provider.getBalance(userAddress);
                    document.getElementById('ethBalance').textContent = 
                        parseFloat(ethers.utils.formatEther(balance)).toFixed(4);
                        
                } else {
                    log(`‚ùå Transa√ß√£o revertida`, 'error');
                    log(`üí° Seu capital est√° seguro! Flash Loan reverteu tudo.`, 'info');
                }
                
            } catch (error) {
                log(`‚ùå ERRO: ${error.message}`, 'error');
                
                if (error.message.includes('insufficient funds')) {
                    log(`‚ö†Ô∏è Saldo insuficiente para gas`, 'warning');
                } else if (error.message.includes('user rejected')) {
                    log(`‚ö†Ô∏è Transa√ß√£o cancelada pelo usu√°rio`, 'warning');
                } else if (error.message.includes('Insufficient profit')) {
                    log(`‚ö†Ô∏è Lucro insuficiente - mercado mudou rapidamente`, 'warning');
                }
            }
            
            currentOpportunity = null;
        }
        
        // ============================================================
        // INICIALIZA√á√ÉO
        // ============================================================
        
        async function initialize() {
            // Aguarda bibliotecas
            await checkLibraries();
            
            log('‚úÖ Sistema carregado com sucesso', 'success');
            log('‚úÖ Ethers.js carregado', 'success');
            log('‚úÖ TensorFlow.js carregado', 'success');
            
            // AVISO IMPORTANTE SOBRE FLASH LOANS
            log('‚ö° VERDADEIRO FLASH LOAN - Voc√™ s√≥ precisa de GAS!', 'success');
            log('üí∞ Capital do trade vem do flash loan automaticamente', 'ai');
            log('üõ°Ô∏è Se der preju√≠zo, transa√ß√£o reverte - ZERO risco de perda!', 'ai');
            log('‚õΩ Custo: ~0.072 ETH de gas (20 gwei @ 3M limit)', 'info');
            
            // Inicializa IA
            await initNeuralNetwork();
            
            // Inicializa RPC provider
            await initRpcProvider();
            
            updateStatus('üî¥ Desconectado', 'disconnected');
            
            // Event Listeners (ap√≥s p√°gina carregar)
            document.getElementById('connectBtn').addEventListener('click', connectWallet);
            document.getElementById('startBtn').addEventListener('click', startScanner);
            document.getElementById('stopBtn').addEventListener('click', stopScanner);
            
            log('‚úÖ Interface pronta para uso!', 'success');
        }
        
        // Inicia quando p√°gina carregar completamente
        window.addEventListener('load', initialize);
    </script>
</body>
</html>
