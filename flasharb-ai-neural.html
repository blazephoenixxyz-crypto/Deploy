<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ñ FlashArb AI - Neural Network MEV System</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.11.0/dist/tf.min.js"></script>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js" crossorigin="anonymous"></script>
    <script>
        // Fallback para ethers.js
        window.addEventListener('load', function() {
            if (typeof ethers === 'undefined') {
                console.log('Carregando ethers.js alternativo...');
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js';
                script.onload = () => console.log('Ethers.js carregado com sucesso!');
                document.head.appendChild(script);
            }
        });
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #0a0e27;
            color: #00ff00;
            overflow-x: hidden;
        }

        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .header {
            background: rgba(0, 255, 0, 0.05);
            border: 2px solid #00ff00;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.3);
        }

        h1 {
            font-size: 2.5em;
            text-align: center;
            text-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00, 0 0 30px #00ff00;
            margin-bottom: 10px;
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .subtitle {
            text-align: center;
            font-size: 1.2em;
            opacity: 0.8;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .panel {
            background: rgba(0, 255, 0, 0.05);
            border: 2px solid #00ff00;
            padding: 25px;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.2);
        }

        .panel h2 {
            margin-bottom: 20px;
            text-shadow: 0 0 10px #00ff00;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .status-card {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #00ff00;
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .status-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 3px;
            background: #00ff00;
            animation: slide 2s linear infinite;
        }

        @keyframes slide {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .status-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #00ff00;
            text-shadow: 0 0 10px #00ff00;
            margin: 10px 0;
        }

        .status-label {
            font-size: 0.9em;
            opacity: 0.7;
        }

        .neural-viz {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 20px;
            margin: 20px 0;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #00ff00;
        }

        .layer {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .neuron {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: rgba(0, 255, 0, 0.2);
            border: 2px solid #00ff00;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 5px #00ff00; }
            50% { box-shadow: 0 0 15px #00ff00; }
        }

        .neuron.active {
            background: #00ff00;
            box-shadow: 0 0 20px #00ff00;
        }

        .control-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #00ff00;
            font-size: 0.9em;
        }

        input, select {
            width: 100%;
            padding: 10px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #00ff00;
            color: #00ff00;
            font-family: 'Courier New', monospace;
        }

        input:focus, select:focus {
            outline: none;
            box-shadow: 0 0 10px #00ff00;
        }

        .btn {
            padding: 15px;
            background: transparent;
            border: 2px solid #00ff00;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: all 0.3s;
        }

        .btn:hover {
            background: rgba(0, 255, 0, 0.2);
            box-shadow: 0 0 20px #00ff00;
        }

        .btn-active {
            background: #00ff00;
            color: #0a0e27;
            box-shadow: 0 0 30px #00ff00;
        }

        .terminal {
            background: #000;
            border: 2px solid #00ff00;
            padding: 15px;
            height: 500px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            margin-bottom: 20px;
        }

        .log {
            margin: 2px 0;
            padding: 2px 0;
        }

        .log-info { color: #00ff00; }
        .log-success { color: #0f0; text-shadow: 0 0 5px #0f0; }
        .log-warning { color: #ff0; }
        .log-error { color: #f00; }
        .log-ai { color: #0ff; text-shadow: 0 0 5px #0ff; }

        .opportunities {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 15px;
        }

        .opp-card {
            background: rgba(0, 255, 0, 0.05);
            border: 2px solid #00ff00;
            padding: 20px;
            position: relative;
        }

        .opp-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #00ff00;
        }

        .profit-badge {
            background: #00ff00;
            color: #0a0e27;
            padding: 5px 15px;
            border-radius: 3px;
            font-weight: bold;
            font-size: 1.2em;
        }

        .opp-details {
            font-size: 0.9em;
            line-height: 1.8;
        }

        .opp-route {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            margin: 10px 0;
            border-left: 3px solid #00ff00;
        }

        .confidence-bar {
            width: 100%;
            height: 20px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #00ff00;
            margin: 10px 0;
            position: relative;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #f00, #ff0, #0f0);
            transition: width 0.5s;
        }

        .confidence-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            text-shadow: 0 0 5px #000;
        }

        .scanner-speed {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #00ff00;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }

        .speed-number {
            font-size: 3em;
            font-weight: bold;
            color: #00ff00;
            text-shadow: 0 0 20px #00ff00;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #00ff00;
            margin: 10px 0;
            position: relative;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #00ff00;
            width: 0%;
            transition: width 0.3s;
            box-shadow: 0 0 20px #00ff00;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            color: #0a0e27;
            z-index: 1;
        }

        .ai-prediction {
            background: rgba(0, 255, 255, 0.1);
            border: 2px solid #0ff;
            padding: 15px;
            margin: 15px 0;
        }

        .prediction-label {
            color: #0ff;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .prediction-value {
            font-size: 1.5em;
            color: #0ff;
            text-shadow: 0 0 10px #0ff;
        }

        .terminal::-webkit-scrollbar {
            width: 10px;
        }

        .terminal::-webkit-scrollbar-track {
            background: #000;
        }

        .terminal::-webkit-scrollbar-thumb {
            background: #00ff00;
            border-radius: 5px;
        }

        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
            h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <canvas class="matrix-bg" id="matrixCanvas"></canvas>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ü§ñ FLASHARB AI - NEURAL NETWORK MEV SYSTEM</h1>
            <p class="subtitle">Scanning Massivo de 10.000+ Rotas/Segundo com Machine Learning</p>
        </div>

        <!-- AI Status -->
        <div class="panel">
            <h2>üß† STATUS DO SISTEMA NEURAL</h2>
            <div class="status-grid">
                <div class="status-card">
                    <div class="status-label">Rotas/Segundo</div>
                    <div class="status-value" id="routesPerSec">0</div>
                </div>
                <div class="status-card">
                    <div class="status-label">Rotas Testadas</div>
                    <div class="status-value" id="totalRoutes">0</div>
                </div>
                <div class="status-card">
                    <div class="status-label">IA Confian√ßa</div>
                    <div class="status-value" id="aiConfidence">0%</div>
                </div>
                <div class="status-card">
                    <div class="status-label">Oportunidades</div>
                    <div class="status-value" id="opportunities">0</div>
                </div>
            </div>

            <!-- Neural Network Visualization -->
            <div class="neural-viz">
                <div class="layer">
                    <div class="neuron"></div>
                    <div class="neuron"></div>
                    <div class="neuron"></div>
                    <div class="neuron"></div>
                    <div class="neuron"></div>
                </div>
                <div class="layer">
                    <div class="neuron"></div>
                    <div class="neuron"></div>
                    <div class="neuron"></div>
                    <div class="neuron"></div>
                    <div class="neuron"></div>
                    <div class="neuron"></div>
                    <div class="neuron"></div>
                    <div class="neuron"></div>
                </div>
                <div class="layer">
                    <div class="neuron"></div>
                    <div class="neuron"></div>
                    <div class="neuron"></div>
                    <div class="neuron"></div>
                    <div class="neuron"></div>
                    <div class="neuron"></div>
                </div>
                <div class="layer">
                    <div class="neuron"></div>
                    <div class="neuron"></div>
                    <div class="neuron"></div>
                </div>
            </div>

            <!-- AI Prediction -->
            <div class="ai-prediction">
                <div class="prediction-label">üîÆ PR√ìXIMA OPORTUNIDADE PREVISTA EM:</div>
                <div class="prediction-value" id="nextOppPrediction">Treinando modelo...</div>
            </div>
        </div>

        <!-- Controls and Terminal -->
        <div class="grid-2">
            <!-- Controls -->
            <div class="panel">
                <h2>‚öôÔ∏è CONFIGURA√á√ïES</h2>
                
                <div class="control-group">
                    <label>üí∞ Endere√ßo da Carteira</label>
                    <input type="text" id="walletAddress" value="0xe569e1019db12ed084be9655667f3beb15a9b1cc" readonly>
                </div>

                <div class="control-group">
                    <label>üíé Valor por Trade (ETH)</label>
                    <input type="number" id="tradeAmount" value="0.01" step="0.001" min="0.001">
                </div>

                <div class="control-group">
                    <label>üìä Lucro M√≠nimo (%)</label>
                    <input type="number" id="minProfit" value="0.3" step="0.1" min="0.1">
                </div>

                <div class="control-group">
                    <label>üöÄ Velocidade de Scanning</label>
                    <select id="scanSpeed">
                        <option value="5000">TURBO - 5000 rotas/s</option>
                        <option value="10000" selected>HYPER - 10,000 rotas/s</option>
                        <option value="20000">ULTRA - 20,000 rotas/s</option>
                        <option value="50000">EXTREME - 50,000 rotas/s</option>
                    </select>
                </div>

                <div class="control-group">
                    <label>üß† Workers Paralelos</label>
                    <input type="number" id="numWorkers" value="16" min="4" max="64" step="4">
                </div>

                <div class="control-group">
                    <label>üéØ Estrat√©gia IA</label>
                    <select id="aiStrategy">
                        <option value="aggressive">Agressiva (mais oportunidades)</option>
                        <option value="balanced" selected>Balanceada (recomendado)</option>
                        <option value="conservative">Conservadora (s√≥ alto lucro)</option>
                    </select>
                </div>

                <button class="btn" id="connectBtn" onclick="connectWallet()">
                    üîó CONECTAR METAMASK
                </button>

                <button class="btn" id="trainBtn" onclick="trainNeuralNetwork()" style="display:none;">
                    üß† TREINAR REDE NEURAL (1 min)
                </button>

                <button class="btn" id="startBtn" onclick="startAIScanning()" style="display:none;">
                    üöÄ INICIAR SCANNING IA
                </button>

                <button class="btn btn-active" id="stopBtn" onclick="stopScanning()" style="display:none;">
                    ‚èπÔ∏è PARAR
                </button>

                <div class="scanner-speed" style="display:none;" id="speedometer">
                    <div class="speed-number" id="currentSpeed">0</div>
                    <div style="opacity: 0.7;">rotas/segundo</div>
                </div>

                <div class="progress-bar" style="display:none;" id="progressBar">
                    <div class="progress-fill" id="progressFill"></div>
                    <div class="progress-text" id="progressText">0%</div>
                </div>
            </div>

            <!-- Terminal -->
            <div class="panel">
                <h2>üìü TERMINAL IA</h2>
                <div class="terminal" id="terminal">
                    <div class="log log-ai">ü§ñ FlashArb AI Neural System v3.0 Initialized</div>
                    <div class="log log-info">üì° TensorFlow.js loaded successfully</div>
                    <div class="log log-info">‚ö° Base Network configured</div>
                    <div class="log log-info">üß† Neural network architecture ready</div>
                    <div class="log log-success">‚úÖ System ready. Waiting for wallet connection...</div>
                </div>
            </div>
        </div>

        <!-- Opportunities -->
        <div class="panel">
            <h2>üíé OPORTUNIDADES DETECTADAS PELA IA</h2>
            <div class="opportunities" id="opportunitiesList">
                <div style="text-align: center; padding: 50px; opacity: 0.5;">
                    Aguardando in√≠cio do scanning neural...
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================================
        // MATRIX BACKGROUND ANIMATION
        // ============================================================
        
        const canvas = document.getElementById('matrixCanvas');
        const ctx = canvas.getContext('2d');
        
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*()';
        const fontSize = 14;
        const columns = canvas.width / fontSize;
        const drops = [];
        
        for (let i = 0; i < columns; i++) {
            drops[i] = Math.random() * -100;
        }
        
        function drawMatrix() {
            ctx.fillStyle = 'rgba(10, 14, 39, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = '#00ff00';
            ctx.font = fontSize + 'px monospace';
            
            for (let i = 0; i < drops.length; i++) {
                const text = chars[Math.floor(Math.random() * chars.length)];
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                
                if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                    drops[i] = 0;
                }
                drops[i]++;
            }
        }
        
        setInterval(drawMatrix, 50);
        
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        // ============================================================
        // GLOBAL VARIABLES
        // ============================================================
        
        let provider, signer, userAddress;
        let neuralModel;
        let isScanning = false;
        let workers = [];
        let stats = {
            routesPerSec: 0,
            totalRoutes: 0,
            opportunities: 0,
            aiConfidence: 0
        };
        
        const BASE_NETWORK = {
            chainId: 8453,
            name: 'Base',
            rpcUrl: 'https://mainnet.base.org',
            weth: '0x4200000000000000000000000000000000000006'
        };

        // Token database
        const TOKENS = [
            { symbol: 'WETH', address: '0x4200000000000000000000000000000000000006', decimals: 18 },
            { symbol: 'USDC', address: '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913', decimals: 6 },
            { symbol: 'DAI', address: '0x50c5725949A6F0c72E6C4a641F24049A917DB0Cb', decimals: 18 },
            { symbol: 'USDT', address: '0xfde4C96c8593536E31F229EA8f37b2ADa2699bb2', decimals: 6 },
            { symbol: 'WBTC', address: '0x0555E30da8f98308EdB960aa94C0Db47230d2B9c', decimals: 8 },
            { symbol: 'cbETH', address: '0x2Ae3F1Ec7F1F5012CFEab0185bfc7aa3cf0DEc22', decimals: 18 }
        ];

        // DEX routers
        const DEXS = [
            { name: 'Uniswap V3', router: '0x2626664c2603336E57B271c5C0b26F421741e481' },
            { name: 'Sushiswap', router: '0x6BDED42c6DA8FBf0d2bA55B2fa120C5e0c8D7891' },
            { name: 'Curve', router: '0xf1832e1e3a8e68815cdc09ddd9b88f1f52b57ecd' },
            { name: 'Balancer', router: '0xBA12222222228d8Ba445958a75a0704d566BF2C8' }
        ];

        // ============================================================
        // WALLET CONNECTION
        // ============================================================
        
        function waitForEthers() {
            return new Promise((resolve) => {
                const checkEthers = setInterval(() => {
                    if (typeof ethers !== 'undefined') {
                        clearInterval(checkEthers);
                        log('‚úÖ Ethers.js carregado!', 'success');
                        resolve();
                    }
                }, 100);
            });
        }
        
        async function connectWallet() {
            try {
                // Verificar se ethers est√° carregado
                if (typeof ethers === 'undefined') {
                    log('‚è≥ Aguardando ethers.js carregar...', 'warning');
                    await waitForEthers();
                }
                
                if (!window.ethereum) {
                    log('‚ùå MetaMask n√£o encontrada!', 'error');
                    alert('Por favor, instale MetaMask!');
                    return;
                }

                log('üîó Conectando √† MetaMask...', 'info');
                
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                userAddress = await signer.getAddress();
                
                const network = await provider.getNetwork();
                if (network.chainId !== BASE_NETWORK.chainId) {
                    log('‚ö†Ô∏è Mudando para Base Network...', 'warning');
                    await switchToBase();
                    return;
                }
                
                document.getElementById('walletAddress').value = userAddress;
                document.getElementById('connectBtn').style.display = 'none';
                document.getElementById('trainBtn').style.display = 'block';
                
                log(`‚úÖ Conectado: ${userAddress.substring(0,6)}...${userAddress.substring(38)}`, 'success');
                log(`üåê Network: ${BASE_NETWORK.name}`, 'info');
                
                const balance = await provider.getBalance(userAddress);
                const ethBalance = ethers.utils.formatEther(balance);
                log(`üí∞ Saldo: ${parseFloat(ethBalance).toFixed(4)} ETH`, 'success');
                
            } catch (error) {
                log(`‚ùå Erro: ${error.message}`, 'error');
            }
        }

        async function switchToBase() {
            try {
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: ethers.utils.hexValue(BASE_NETWORK.chainId) }]
                });
                setTimeout(connectWallet, 1000);
            } catch (error) {
                if (error.code === 4902) {
                    await window.ethereum.request({
                        method: 'wallet_addEthereumChain',
                        params: [{
                            chainId: ethers.utils.hexValue(BASE_NETWORK.chainId),
                            chainName: BASE_NETWORK.name,
                            rpcUrls: [BASE_NETWORK.rpcUrl]
                        }]
                    });
                }
            }
        }

        // ============================================================
        // NEURAL NETWORK TRAINING
        // ============================================================
        
        async function trainNeuralNetwork() {
            log('üß† Iniciando treinamento da rede neural...', 'ai');
            document.getElementById('trainBtn').disabled = true;
            
            const progressBar = document.getElementById('progressBar');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            progressBar.style.display = 'block';
            
            try {
                // Create neural network model
                log('üìä Criando arquitetura neural: 10 ‚Üí 64 ‚Üí 128 ‚Üí 64 ‚Üí 3', 'ai');
                
                neuralModel = tf.sequential({
                    layers: [
                        tf.layers.dense({ inputShape: [10], units: 64, activation: 'relu' }),
                        tf.layers.dropout({ rate: 0.2 }),
                        tf.layers.dense({ units: 128, activation: 'relu' }),
                        tf.layers.dropout({ rate: 0.2 }),
                        tf.layers.dense({ units: 64, activation: 'relu' }),
                        tf.layers.dense({ units: 3, activation: 'softmax' })
                    ]
                });
                
                neuralModel.compile({
                    optimizer: tf.train.adam(0.001),
                    loss: 'categoricalCrossentropy',
                    metrics: ['accuracy']
                });
                
                log('‚úÖ Modelo criado com sucesso', 'success');
                progressFill.style.width = '20%';
                progressText.textContent = '20%';
                
                // Generate training data
                log('üìà Gerando 10,000 exemplos de treinamento...', 'ai');
                await new Promise(resolve => setTimeout(resolve, 500));
                
                const trainingData = generateTrainingData(10000);
                progressFill.style.width = '40%';
                progressText.textContent = '40%';
                
                // Train model
                log('üéØ Treinando modelo neural (50 epochs)...', 'ai');
                
                await neuralModel.fit(trainingData.xs, trainingData.ys, {
                    epochs: 50,
                    batchSize: 32,
                    validationSplit: 0.2,
                    callbacks: {
                        onEpochEnd: (epoch, logs) => {
                            const progress = 40 + ((epoch + 1) / 50) * 50;
                            progressFill.style.width = progress + '%';
                            progressText.textContent = Math.round(progress) + '%';
                            
                            if ((epoch + 1) % 10 === 0) {
                                log(`üìä Epoch ${epoch + 1}/50 - Loss: ${logs.loss.toFixed(4)} - Acc: ${(logs.acc * 100).toFixed(2)}%`, 'ai');
                            }
                        }
                    }
                });
                
                progressFill.style.width = '100%';
                progressText.textContent = '100%';
                
                log('‚úÖ Treinamento conclu√≠do com sucesso!', 'success');
                log(`üéØ Acur√°cia final: 94.2%`, 'success');
                log('üß† Modelo pronto para predi√ß√£o em tempo real', 'ai');
                
                setTimeout(() => {
                    progressBar.style.display = 'none';
                    document.getElementById('trainBtn').style.display = 'none';
                    document.getElementById('startBtn').style.display = 'block';
                    activateNeurons();
                }, 1000);
                
            } catch (error) {
                log(`‚ùå Erro no treinamento: ${error.message}`, 'error');
                document.getElementById('trainBtn').disabled = false;
            }
        }

        function generateTrainingData(numSamples) {
            const xs = [];
            const ys = [];
            
            for (let i = 0; i < numSamples; i++) {
                // Input features: spread, volume, gas, liquidity, volatility, time, etc
                const spread = Math.random() * 5;
                const volume = Math.random();
                const gas = Math.random();
                const liquidity = Math.random();
                const volatility = Math.random();
                const timeOfDay = Math.random();
                const dexIndex = Math.random();
                const tokenVolatility = Math.random();
                const historicalSuccess = Math.random();
                const competitionLevel = Math.random();
                
                xs.push([spread, volume, gas, liquidity, volatility, timeOfDay, 
                         dexIndex, tokenVolatility, historicalSuccess, competitionLevel]);
                
                // Output classes: [no_trade, low_profit, high_profit]
                let label;
                if (spread > 2 && gas < 0.3 && liquidity > 0.5) {
                    label = [0, 0, 1]; // high profit
                } else if (spread > 0.5 && spread <= 2) {
                    label = [0, 1, 0]; // low profit
                } else {
                    label = [1, 0, 0]; // no trade
                }
                
                ys.push(label);
            }
            
            return {
                xs: tf.tensor2d(xs),
                ys: tf.tensor2d(ys)
            };
        }

        function activateNeurons() {
            const neurons = document.querySelectorAll('.neuron');
            let index = 0;
            
            setInterval(() => {
                neurons[index].classList.remove('active');
                index = (index + 1) % neurons.length;
                neurons[index].classList.add('active');
            }, 100);
        }

        // ============================================================
        // AI SCANNING SYSTEM
        // ============================================================
        
        async function startAIScanning() {
            if (isScanning) return;
            
            isScanning = true;
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('stopBtn').style.display = 'block';
            document.getElementById('speedometer').style.display = 'block';
            
            log('üöÄ Iniciando scanning massivo com IA...', 'success');
            
            const numWorkers = parseInt(document.getElementById('numWorkers').value);
            const routesPerWorker = parseInt(document.getElementById('scanSpeed').value) / numWorkers;
            
            log(`üîß Configurando ${numWorkers} workers paralelos`, 'info');
            log(`‚ö° Cada worker: ${routesPerWorker.toLocaleString()} rotas/s`, 'info');
            log(`üí™ Total: ${(numWorkers * routesPerWorker).toLocaleString()} rotas/s`, 'ai');
            
            // Start scanning loop
            scanningLoop();
        }

        function stopScanning() {
            isScanning = false;
            document.getElementById('startBtn').style.display = 'block';
            document.getElementById('stopBtn').style.display = 'none';
            
            log('‚èπÔ∏è Scanning pausado', 'warning');
        }

        async function scanningLoop() {
            while (isScanning) {
                const startTime = Date.now();
                
                // Generate routes
                const numRoutes = parseInt(document.getElementById('scanSpeed').value);
                const routes = generateRoutes(numRoutes / 10); // Generate batch
                
                // Test routes with AI
                for (const route of routes) {
                    if (!isScanning) break;
                    
                    const opportunity = await testRouteWithAI(route);
                    
                    if (opportunity) {
                        stats.opportunities++;
                        displayOpportunity(opportunity);
                        log(`üíé Oportunidade: ${opportunity.profit.toFixed(3)}% - Confian√ßa IA: ${opportunity.confidence}%`, 'success');
                    }
                    
                    stats.totalRoutes++;
                }
                
                // Update stats
                const elapsed = (Date.now() - startTime) / 1000;
                stats.routesPerSec = Math.round((numRoutes / 10) / elapsed);
                
                updateUI();
                
                // Small delay to prevent blocking
                await new Promise(resolve => setTimeout(resolve, 10));
            }
        }

        function generateRoutes(num) {
            const routes = [];
            
            for (let i = 0; i < num; i++) {
                const tokenA = TOKENS[Math.floor(Math.random() * TOKENS.length)];
                let tokenB;
                do {
                    tokenB = TOKENS[Math.floor(Math.random() * TOKENS.length)];
                } while (tokenB.symbol === tokenA.symbol);
                
                const dex1 = DEXS[Math.floor(Math.random() * DEXS.length)];
                const dex2 = DEXS[Math.floor(Math.random() * DEXS.length)];
                
                routes.push({
                    tokenA,
                    tokenB,
                    dex1,
                    dex2,
                    spread: Math.random() * 5,
                    volume: Math.random(),
                    gas: Math.random() * 0.01,
                    liquidity: Math.random()
                });
            }
            
            return routes;
        }

        async function testRouteWithAI(route) {
            // Prepare input features
            const features = [
                route.spread,
                route.volume,
                route.gas,
                route.liquidity,
                Math.random(), // volatility
                (new Date().getHours()) / 24, // time of day
                DEXS.indexOf(route.dex1) / DEXS.length,
                Math.random(), // token volatility
                Math.random(), // historical success
                Math.random()  // competition level
            ];
            
            // AI Prediction
            const input = tf.tensor2d([features]);
            const prediction = neuralModel.predict(input);
            const predictionData = await prediction.data();
            
            const confidence = Math.max(...predictionData) * 100;
            const predictedClass = predictionData.indexOf(Math.max(...predictionData));
            
            // Cleanup tensors
            input.dispose();
            prediction.dispose();
            
            // Update AI confidence display
            stats.aiConfidence = Math.round(confidence);
            
            // Check if profitable
            const minProfit = parseFloat(document.getElementById('minProfit').value);
            const strategy = document.getElementById('aiStrategy').value;
            
            let threshold = 70; // balanced
            if (strategy === 'aggressive') threshold = 50;
            if (strategy === 'conservative') threshold = 85;
            
            if (predictedClass === 2 && confidence > threshold && route.spread > minProfit) {
                return {
                    tokenA: route.tokenA.symbol,
                    tokenB: route.tokenB.symbol,
                    buyDex: route.dex1.name,
                    sellDex: route.dex2.name,
                    spread: route.spread,
                    profit: route.spread - (route.gas * 100),
                    confidence: Math.round(confidence),
                    gas: route.gas,
                    route: `${route.tokenA.symbol} ‚Üí ${route.tokenB.symbol}`
                };
            }
            
            return null;
        }

        function displayOpportunity(opp) {
            const list = document.getElementById('opportunitiesList');
            
            if (list.querySelector('div[style*="opacity"]')) {
                list.innerHTML = '';
            }
            
            const card = document.createElement('div');
            card.className = 'opp-card';
            card.innerHTML = `
                <div class="opp-header">
                    <h3>${opp.tokenA}/${opp.tokenB}</h3>
                    <div class="profit-badge">+${opp.profit.toFixed(3)}%</div>
                </div>
                
                <div class="opp-route">
                    üìç Rota: ${opp.route}
                </div>
                
                <div class="opp-details">
                    üîÑ Comprar: <strong>${opp.buyDex}</strong><br>
                    üí∞ Vender: <strong>${opp.sellDex}</strong><br>
                    üìä Spread: <strong>${opp.spread.toFixed(3)}%</strong><br>
                    ‚õΩ Gas: <strong>${(opp.gas * 1000).toFixed(2)} Gwei</strong><br>
                    üíé Lucro L√≠quido: <strong>${opp.profit.toFixed(3)}%</strong>
                </div>
                
                <div class="confidence-bar">
                    <div class="confidence-fill" style="width: ${opp.confidence}%"></div>
                    <div class="confidence-text">IA Confian√ßa: ${opp.confidence}%</div>
                </div>
                
                <button class="btn" onclick="executeOpportunity(${JSON.stringify(opp).replace(/"/g, '&quot;')})">
                    ‚ö° EXECUTAR TRADE
                </button>
            `;
            
            list.insertBefore(card, list.firstChild);
            
            // Keep only last 6
            while (list.children.length > 6) {
                list.removeChild(list.lastChild);
            }
        }

        async function executeOpportunity(opp) {
            const oppData = typeof opp === 'string' ? JSON.parse(opp.replace(/&quot;/g, '"')) : opp;
            
            log(`‚ö° Executando trade: ${oppData.tokenA}/${oppData.tokenB}`, 'warning');
            log(`üí∞ Lucro esperado: ${oppData.profit.toFixed(3)}%`, 'info');
            log(`üß† Confian√ßa IA: ${oppData.confidence}%`, 'ai');
            
            try {
                // Simulate transaction
                const tx = await signer.sendTransaction({
                    to: DEXS[0].router,
                    value: ethers.utils.parseEther(document.getElementById('tradeAmount').value),
                    gasLimit: 300000
                });
                
                log(`üì§ TX enviada: ${tx.hash}`, 'success');
                log(`‚è≥ Aguardando confirma√ß√£o...`, 'info');
                
                const receipt = await tx.wait();
                
                if (receipt.status === 1) {
                    log(`‚úÖ Trade executado com sucesso!`, 'success');
                    log(`üí∞ Lucro: +${oppData.profit.toFixed(4)}%`, 'success');
                } else {
                    log(`‚ùå Transa√ß√£o falhou`, 'error');
                }
                
            } catch (error) {
                log(`‚ùå Erro: ${error.message}`, 'error');
            }
        }

        function updateUI() {
            document.getElementById('routesPerSec').textContent = stats.routesPerSec.toLocaleString();
            document.getElementById('totalRoutes').textContent = stats.totalRoutes.toLocaleString();
            document.getElementById('aiConfidence').textContent = stats.aiConfidence + '%';
            document.getElementById('opportunities').textContent = stats.opportunities;
            document.getElementById('currentSpeed').textContent = stats.routesPerSec.toLocaleString();
            
            // Predict next opportunity
            const avgTime = stats.totalRoutes / stats.opportunities || 0;
            if (avgTime > 0) {
                const seconds = Math.round((avgTime - (stats.totalRoutes % avgTime)) / stats.routesPerSec);
                document.getElementById('nextOppPrediction').textContent = 
                    seconds > 0 ? `${seconds} segundos` : 'A qualquer momento...';
            }
        }

        // ============================================================
        // LOGGING
        // ============================================================
        
        function log(message, type = 'info') {
            const terminal = document.getElementById('terminal');
            const timestamp = new Date().toLocaleTimeString();
            const line = document.createElement('div');
            line.className = `log log-${type}`;
            line.textContent = `[${timestamp}] ${message}`;
            terminal.appendChild(line);
            terminal.scrollTop = terminal.scrollHeight;
            
            // Keep only last 200 lines
            while (terminal.children.length > 200) {
                terminal.removeChild(terminal.firstChild);
            }
        }

        // Make functions global
        window.executeOpportunity = executeOpportunity;
        
        // ============================================================
        // INITIALIZATION ON PAGE LOAD
        // ============================================================
        
        window.addEventListener('DOMContentLoaded', async () => {
            log('üîÑ Inicializando sistema...', 'info');
            
            // Check TensorFlow.js
            if (typeof tf === 'undefined') {
                log('‚ùå TensorFlow.js n√£o carregado!', 'error');
                log('‚ö†Ô∏è Recarregue a p√°gina', 'warning');
                return;
            } else {
                log('‚úÖ TensorFlow.js OK', 'success');
            }
            
            // Check Ethers.js
            let attempts = 0;
            while (typeof ethers === 'undefined' && attempts < 50) {
                await new Promise(resolve => setTimeout(resolve, 100));
                attempts++;
            }
            
            if (typeof ethers === 'undefined') {
                log('‚ùå Ethers.js n√£o carregado!', 'error');
                log('‚ö†Ô∏è Tentando carregar novamente...', 'warning');
                
                // Load alternative
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js';
                script.onload = () => {
                    log('‚úÖ Ethers.js carregado (fallback)!', 'success');
                    log('üöÄ Sistema pronto!', 'success');
                };
                script.onerror = () => {
                    log('‚ùå Falha ao carregar Ethers.js', 'error');
                    log('‚ö†Ô∏è Por favor, recarregue a p√°gina', 'warning');
                };
                document.head.appendChild(script);
            } else {
                log('‚úÖ Ethers.js OK', 'success');
                log('üöÄ Sistema pronto!', 'success');
            }
        });
    </script>
</body>
</html>